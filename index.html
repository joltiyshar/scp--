<!DOCTYPE html>
<html lang="ru"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCP FOUNDATION — ОБЪЕКТНАЯ БАЗА ДАННЫХ</title>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;family=Share+Tech+Mono&amp;family=Courier+Prime:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
<style>
:root {
  --bg:#080808;--bg2:#0d0d0b;--surface:#111109;--surface2:#181815;
  --border:#2a2a24;--border2:#3d3d32;
  --text:#c8c4a8;--text-dim:#6b6858;--text-bright:#e0dcc4;
  --red:#cc1111;--red2:#991111;--red-dim:#4a0808;
  --amber:#c4920a;--amber-dim:#6b4f05;
  --green:#4a7a30;--green-dim:#1e3010;
  --mono:'Share Tech Mono','Courier New',monospace;
  --serif:'Courier Prime','Courier New',monospace;
  --title:'Special Elite','Courier New',monospace;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;}
body{background:var(--bg);color:var(--text);font-family:var(--serif);font-size:15px;overflow:hidden;cursor:crosshair;}

/* scanlines */
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.08) 2px,rgba(0,0,0,.08) 4px);pointer-events:none;z-index:9998;}
/* noise */
body::before{content:'';position:fixed;inset:-50%;width:200%;height:200%;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");animation:noise .4s steps(1) infinite;pointer-events:none;z-index:9997;opacity:.4;}
@keyframes noise{0%,100%{transform:translate(0,0)}10%{transform:translate(-2px,1px)}20%{transform:translate(2px,-1px)}30%{transform:translate(-1px,2px)}40%{transform:translate(1px,-2px)}50%{transform:translate(-2px,-1px)}60%{transform:translate(2px,2px)}70%{transform:translate(-1px,-1px)}80%{transform:translate(1px,1px)}90%{transform:translate(0,-2px)}}

/* BOOT */
#bootScreen{position:fixed;inset:0;background:#000;z-index:9000;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:var(--mono);font-size:13px;color:#cc1111;}
.boot-logo{font-size:52px;margin-bottom:20px;letter-spacing:6px;}
.boot-line{color:#555;margin:2px 0;}.boot-line.ok{color:#4a7a30;}.boot-line.warn{color:var(--amber);}
.blink{animation:blink 1s step-end infinite;}
@keyframes blink{50%{opacity:0;}}

/* HEADER */
header{height:56px;background:var(--bg2);border-bottom:2px solid var(--border);display:flex;align-items:center;padding:0 20px;gap:16px;z-index:100;flex-shrink:0;}
.scp-logo{font-family:var(--title);font-size:20px;color:var(--red);letter-spacing:3px;display:flex;align-items:center;gap:10px;white-space:nowrap;}
.header-mid{flex:1;font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:1px;line-height:1.6;}
.header-right{display:flex;align-items:center;gap:10px;}
.access-badge{font-family:var(--mono);font-size:10px;padding:4px 10px;border:1px solid;letter-spacing:2px;}
.access-badge.ro{color:var(--text-dim);border-color:var(--border2);}
.access-badge.adm{color:var(--amber);border-color:var(--amber-dim);animation:pAmber 2s ease infinite;}
@keyframes pAmber{0%,100%{box-shadow:0 0 4px rgba(196,146,10,.3)}50%{box-shadow:0 0 12px rgba(196,146,10,.7)}}
.hbtn{display:inline-flex;align-items:center;gap:4px;padding:5px 10px;border:1px solid var(--border2);background:transparent;color:var(--text-dim);font-family:var(--mono);font-size:10px;cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .15s;}
.hbtn:hover{border-color:var(--red2);color:var(--red);}
.hbtn.danger{border-color:var(--red2);color:var(--red);}
.hbtn.danger:hover{background:var(--red-dim);}

/* LAYOUT */
.app{display:flex;height:calc(100vh - 56px);overflow:hidden;}

/* SIDEBAR */
.sidebar{width:268px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;overflow:hidden;}
.sb-head{padding:12px 16px;border-bottom:1px solid var(--border);background:var(--bg2);}
.sb-label{font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;display:flex;align-items:center;gap:6px;}
.sb-label::before{content:'';width:6px;height:6px;background:var(--red);animation:pRed 1.5s ease infinite;}
@keyframes pRed{0%,100%{opacity:1;box-shadow:0 0 4px var(--red)}50%{opacity:.3;}}
.sb-search{background:transparent;border:1px solid var(--border);color:var(--text);font-family:var(--mono);font-size:12px;padding:6px 10px;width:100%;outline:none;letter-spacing:1px;}
.sb-search:focus{border-color:var(--red2);}.sb-search::placeholder{color:var(--text-dim);}
.entity-list{flex:1;overflow-y:auto;padding:6px 0;}
.entity-list::-webkit-scrollbar{width:4px;}.entity-list::-webkit-scrollbar-thumb{background:var(--border2);}
.ent{padding:10px 16px;cursor:pointer;border-left:3px solid transparent;border-bottom:1px solid rgba(42,42,36,.5);transition:all .15s;position:relative;}
.ent:hover{background:var(--surface2);border-left-color:var(--border2);}
.ent.active{background:var(--surface2);border-left-color:var(--red);}
.ent-num{font-family:var(--mono);font-size:10px;color:var(--text-dim);margin-bottom:3px;letter-spacing:1px;}
.ent-name{font-family:var(--title);font-size:14px;color:var(--text-bright);margin-bottom:4px;}
.ent-name:hover{animation:glitch .3s linear;}
@keyframes glitch{0%,100%{text-shadow:none}20%{text-shadow:-2px 0 var(--red)}50%{text-shadow:2px 0 var(--amber)}80%{text-shadow:-1px 0 rgba(100,200,255,.5)}}
.tbadge{display:inline-block;font-family:var(--mono);font-size:9px;padding:1px 6px;letter-spacing:2px;font-weight:bold;}
.tbadge.SAFE{background:var(--green-dim);color:#6ab040;border:1px solid var(--green);}
.tbadge.EUCLID{background:#4a3800;color:#c4920a;border:1px solid var(--amber-dim);}
.tbadge.KETER{background:var(--red-dim);color:#ff4444;border:1px solid var(--red2);animation:gRed 2s ease infinite;}
.tbadge.THAUMIEL{background:#0a1a3a;color:#4488cc;border:1px solid #224466;}
.tbadge.NEUTRALIZED{background:#1a1a1a;color:#666;border:1px solid #333;text-decoration:line-through;}
@keyframes gRed{0%,100%{box-shadow:0 0 4px rgba(204,17,17,.4)}50%{box-shadow:0 0 10px rgba(204,17,17,.8)}}
.ent-del{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--red2);cursor:pointer;font-size:13px;opacity:0;transition:opacity .15s;padding:4px;}
.ent:hover .ent-del{opacity:1;}
.sb-foot{padding:12px 16px;border-top:1px solid var(--border);background:var(--bg2);}
.sbtn{display:flex;align-items:center;justify-content:center;gap:6px;padding:7px 14px;border:1px solid var(--border2);background:transparent;color:var(--text-dim);font-family:var(--mono);font-size:11px;cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .15s;width:100%;}
.sbtn:hover{border-color:var(--red2);color:var(--red);}
.sbtn.danger{border-color:var(--red2);color:var(--red);}
.sbtn.danger:hover{background:var(--red-dim);box-shadow:0 0 10px rgba(204,17,17,.3);}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-dim);font-family:var(--mono);text-align:center;padding:40px;gap:12px;}
.empty-state .sym{font-size:80px;opacity:.07;filter:blur(1px);margin-bottom:10px;}
.empty-state h2{font-family:var(--title);font-size:20px;color:var(--border2);letter-spacing:3px;}
.empty-state p{font-size:12px;letter-spacing:1px;opacity:.6;max-width:360px;line-height:1.8;}

/* DOC VIEW */
.doc-view{flex:1;display:flex;flex-direction:column;overflow:hidden;animation:fslide .25s ease;}
@keyframes fslide{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.ro-banner{background:var(--red-dim);border-bottom:1px solid var(--red2);padding:5px 20px;font-family:var(--mono);font-size:10px;color:#ff6666;letter-spacing:3px;text-transform:uppercase;text-align:center;flex-shrink:0;}

/* DOC HEADER */
.doc-header{background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0;position:relative;}
.doc-id-corner{position:absolute;top:8px;right:12px;font-family:var(--mono);font-size:9px;color:var(--border2);letter-spacing:2px;}
.dh-top{display:flex;align-items:stretch;border-bottom:1px solid var(--border);}
.dh-logo{padding:14px 18px;border-right:1px solid var(--border);display:flex;align-items:center;justify-content:center;background:var(--bg2);}
.dh-info{padding:10px 18px;flex:1;}
.dh-num{font-family:var(--title);font-size:26px;color:var(--red);letter-spacing:2px;margin-bottom:4px;}
.dh-name{font-family:var(--title);font-size:21px;color:var(--text-bright);letter-spacing:1px;}
.dh-name-input{font-family:var(--title)!important;font-size:21px!important;color:var(--text-bright)!important;background:transparent;border:none!important;border-bottom:1px dashed var(--border)!important;outline:none;width:100%;padding:0!important;}
.dh-stamps{padding:10px 14px;display:flex;gap:10px;align-items:center;border-right:1px solid var(--border);flex-direction:column;justify-content:center;}
.stamp{font-family:var(--title);font-size:10px;padding:3px 7px;border:2px solid;letter-spacing:2px;opacity:.85;white-space:nowrap;}
.stamp.cl{color:#b80000;border-color:#b80000;transform:rotate(3deg);}
.stamp.re{color:var(--amber);border-color:var(--amber-dim);transform:rotate(-4deg);}
.dh-meta{display:grid;grid-template-columns:repeat(4,1fr);}
.dh-cell{padding:7px 12px;border-right:1px solid var(--border);}
.dh-cell:last-child{border-right:none;}
.dh-cell-label{font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase;margin-bottom:3px;}
.dh-cell-val{font-family:var(--mono);font-size:12px;color:var(--text-bright);}
.meta-inp{background:transparent;border:none;border-bottom:1px dashed var(--border);color:var(--text-bright);font-family:var(--mono);font-size:12px;outline:none;width:100%;}
.meta-sel{background:transparent;border:none;border-bottom:1px dashed var(--border);color:var(--text-bright);font-family:var(--mono);font-size:12px;outline:none;width:100%;cursor:pointer;}
.meta-sel option{background:var(--surface2);}

/* EDITOR PANES */
.panes{flex:1;display:flex;overflow:hidden;}

/* WRITE PANE */
.pane-write{flex:1;display:flex;flex-direction:column;border-right:1px solid var(--border);min-width:0;}
.pane-label{padding:5px 14px;background:var(--bg2);border-bottom:1px solid var(--border);font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:3px;text-transform:uppercase;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}

/* MARKDOWN TOOLBAR */
.md-bar{padding:5px 8px;background:var(--surface);border-bottom:1px solid var(--border);display:flex;gap:3px;flex-wrap:wrap;align-items:center;flex-shrink:0;}
.mdb{font-family:var(--mono);font-size:11px;padding:3px 7px;border:1px solid var(--border);background:transparent;color:var(--text-dim);cursor:pointer;letter-spacing:.5px;transition:all .1s;white-space:nowrap;}
.mdb:hover{border-color:var(--red2);color:var(--red);background:var(--red-dim);}
.mdb-sep{width:1px;height:16px;background:var(--border);margin:0 3px;}

/* TEXTAREA */
.md-ta{flex:1;background:var(--bg2);color:var(--text);font-family:var(--mono);font-size:13px;line-height:1.85;padding:18px 22px;border:none;outline:none;resize:none;tab-size:2;caret-color:var(--red);}
.md-ta::placeholder{color:var(--text-dim);font-style:italic;}
.md-ta::-webkit-scrollbar{width:5px;}.md-ta::-webkit-scrollbar-thumb{background:var(--border2);}

/* HINT BAR */
.md-hints{padding:6px 14px;background:var(--bg2);border-top:1px solid var(--border);font-family:var(--mono);font-size:10px;color:var(--text-dim);display:flex;gap:14px;flex-wrap:wrap;flex-shrink:0;}
.md-hints code{color:var(--border2);background:none;font-size:10px;}

/* PREVIEW PANE */
.pane-preview{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;}
.pane-preview-scroll{flex:1;overflow-y:auto;padding:20px 28px;}
.pane-preview-scroll::-webkit-scrollbar{width:5px;}.pane-preview-scroll::-webkit-scrollbar-thumb{background:var(--border2);}

/* FULL PREVIEW (read-only) */
.pane-full{flex:1;overflow-y:auto;padding:28px 40px;}
.pane-full::-webkit-scrollbar{width:6px;}.pane-full::-webkit-scrollbar-thumb{background:var(--border2);}

/* ══ MARKDOWN RENDERED STYLES ══ */
.md-out{font-family:var(--serif);font-size:15px;color:var(--text);line-height:1.9;}
.md-out h1{font-family:var(--title);font-size:22px;color:var(--text-bright);letter-spacing:3px;text-transform:uppercase;border-bottom:1px solid var(--border);padding-bottom:8px;margin:20px 0 10px;}
.md-out h2{font-family:var(--title);font-size:16px;color:var(--text-bright);letter-spacing:3px;text-transform:uppercase;margin:20px 0 6px;background:var(--red-dim);border-left:4px solid var(--red);padding:7px 14px;}
.md-out h3{font-family:var(--mono);font-size:13px;color:var(--amber);letter-spacing:3px;text-transform:uppercase;margin:14px 0 6px;padding-left:10px;border-left:2px solid var(--amber-dim);}
.md-out h4{font-family:var(--mono);font-size:12px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase;margin:10px 0 4px;}
.md-out h5,.md-out h6{font-family:var(--mono);font-size:11px;color:var(--border2);letter-spacing:2px;margin:8px 0 4px;}
.md-out p{margin:8px 0;}
.md-out strong{color:var(--text-bright);}
.md-out em{color:var(--text-dim);font-style:italic;}
.md-out del{color:var(--text-dim);text-decoration:line-through;}
.md-out a{color:var(--amber);text-decoration:none;border-bottom:1px dashed var(--amber-dim);}
.md-out a:hover{color:var(--text-bright);}
.md-out code{font-family:var(--mono);font-size:12px;background:rgba(0,0,0,.5);color:#88cc88;padding:1px 5px;border:1px solid var(--border);}
.md-out pre{background:#000;border:1px solid var(--border);border-left:3px solid var(--red2);padding:14px 18px;overflow-x:auto;margin:12px 0;}
.md-out pre code{background:none;border:none;padding:0;font-size:12px;color:#88cc88;display:block;}
.md-out blockquote{border-left:4px solid var(--border2);margin:12px 0;padding:8px 16px;background:rgba(0,0,0,.3);color:var(--text-dim);font-style:italic;}
.md-out blockquote p{margin:0;}
.md-out ul,.md-out ol{padding-left:24px;margin:8px 0;}
.md-out li{margin:4px 0;}
.md-out li::marker{color:var(--red2);}
.md-out table{width:100%;border-collapse:collapse;margin:12px 0;font-family:var(--mono);font-size:12px;}
.md-out th{background:var(--surface2);border:1px solid var(--border);padding:7px 12px;color:var(--text-bright);letter-spacing:1px;text-align:left;}
.md-out td{border:1px solid var(--border);padding:6px 12px;}
.md-out tr:nth-child(even) td{background:rgba(0,0,0,.2);}
.md-out hr{border:none;border-top:1px solid var(--border);margin:24px 0;position:relative;}
.md-out hr::after{content:'⬥  ⬥  ⬥';position:absolute;left:50%;transform:translateX(-50%);top:-9px;background:var(--bg);padding:0 12px;color:var(--border2);font-size:11px;letter-spacing:6px;}
.md-out img{max-width:100%;border:1px solid var(--border);display:block;margin:12px auto;filter:contrast(1.05) brightness(.9);}
.preview-hint{font-family:var(--mono);font-size:11px;color:var(--text-dim);letter-spacing:2px;opacity:.35;text-align:center;padding:40px 20px;line-height:2;}

/* MODAL */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:500;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .2s;backdrop-filter:blur(2px);}
.overlay.open{opacity:1;pointer-events:all;}
.modal{background:var(--surface);border:1px solid var(--border2);width:460px;max-width:96vw;transform:scale(.96);transition:transform .2s;box-shadow:0 0 40px rgba(204,17,17,.1),0 0 80px rgba(0,0,0,.8);}
.overlay.open .modal{transform:scale(1);}
.mhd{background:var(--bg2);border-bottom:1px solid var(--border);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;}
.mtitle{font-family:var(--title);font-size:14px;color:var(--red);letter-spacing:3px;text-transform:uppercase;}
.mclose{background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:16px;font-family:var(--mono);}
.mclose:hover{color:var(--red);}
.mbody{padding:22px;}
.mfoot{padding:12px 20px;border-top:1px solid var(--border);background:var(--bg2);display:flex;gap:10px;justify-content:flex-end;}
.mbtn{font-family:var(--mono);font-size:11px;padding:7px 18px;border:1px solid;cursor:pointer;letter-spacing:2px;text-transform:uppercase;background:transparent;transition:all .15s;}
.mbtn.c{border-color:var(--border2);color:var(--text-dim);}
.mbtn.c:hover{color:var(--text);}
.mbtn.ok{border-color:var(--red2);color:var(--red);}
.mbtn.ok:hover{background:var(--red-dim);}
.flabel{font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:3px;text-transform:uppercase;margin-bottom:6px;display:block;}
.frow{margin-bottom:16px;}
.finput{background:var(--bg2);border:1px solid var(--border);color:var(--text-bright);font-family:var(--mono);font-size:14px;padding:8px 12px;outline:none;width:100%;letter-spacing:1px;transition:border-color .15s;}
.finput:focus{border-color:var(--red2);box-shadow:0 0 8px rgba(204,17,17,.2);}
.finput::placeholder{color:var(--text-dim);font-style:italic;}
.fsel{background:var(--bg2);border:1px solid var(--border);color:var(--text-bright);font-family:var(--mono);font-size:12px;padding:8px 12px;outline:none;width:100%;cursor:pointer;}
.fsel option{background:var(--surface2);}
.fsel:focus{border-color:var(--red2);}

/* PASS MODAL */
.pass-disp{font-family:var(--mono);font-size:24px;letter-spacing:8px;color:var(--green);text-align:center;padding:16px;background:#000;border:1px solid var(--green-dim);min-height:60px;display:flex;align-items:center;justify-content:center;}
.pass-err{font-family:var(--mono);font-size:11px;color:var(--red);letter-spacing:2px;text-align:center;min-height:18px;margin-top:6px;}
.pass-err.shake{animation:shake .3s ease;}
@keyframes shake{0%,100%{transform:none}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;margin-top:12px;}

/* IMAGE TABS */
.tab-row{display:flex;gap:4px;margin-bottom:14px;}
.tabBtn{font-family:var(--mono);font-size:10px;padding:5px 12px;border:1px solid var(--border);background:none;color:var(--text-dim);cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .12s;}
.tabBtn.active{border-color:var(--red2);color:var(--red);background:var(--red-dim);}
.tab-p{display:none;}.tab-p.active{display:block;}
.dzone{border:2px dashed var(--border);padding:28px;text-align:center;color:var(--text-dim);font-family:var(--mono);font-size:11px;letter-spacing:2px;cursor:pointer;transition:all .2s;background:var(--bg2);}
.dzone:hover,.dzone.over{border-color:var(--red2);color:var(--red);background:var(--red-dim);}
.dzone input{display:none;}

/* TOAST */
.toast{position:fixed;bottom:20px;right:20px;background:var(--surface2);border:1px solid var(--border2);border-left:4px solid var(--red);font-family:var(--mono);font-size:11px;color:var(--text);padding:10px 16px;letter-spacing:2px;text-transform:uppercase;z-index:9990;transform:translateX(130%);transition:transform .25s;max-width:320px;}
.toast.show{transform:none;}
</style>
</head>
<body>

<!-- BOOT -->
<div id="bootScreen" style="display: none;">
  <div class="boot-logo">☣</div>
  <div class="boot-line">SCP FOUNDATION — SECURE CONTAIN PROTECT</div>
  <div class="boot-line" style="margin:8px 0;color:#1a1a14;">——————————————————————————————</div>
  <div class="boot-line ok">[OK] ИНИЦИАЛИЗАЦИЯ ПРОТОКОЛОВ БЕЗОПАСНОСТИ</div>
  <div class="boot-line ok">[OK] ПРОВЕРКА ЦЕЛОСТНОСТИ БАЗЫ ДАННЫХ</div>
  <div class="boot-line warn">[!!] ОБНАРУЖЕНЫ АНОМАЛЬНЫЕ ОБЪЕКТЫ: СВЕРКА...</div>
  <div class="boot-line ok">[OK] УРОВЕНЬ ДОСТУПА: ТОЛЬКО ЧТЕНИЕ</div>
  <div class="boot-line ok">[OK] СОЕДИНЕНИЕ С СЕРВЕРОМ О5</div>
  <div class="boot-line" style="margin-top:16px;color:#2a2a24;font-size:11px;">ДОСТУП РАЗРЕШЁН <span class="blink">█</span></div>
</div>

<!-- HEADER -->
<header>
  <div class="scp-logo">
    <svg width="32" height="32" viewBox="0 0 100 100" fill="none">
      <circle cx="50" cy="50" r="45" stroke="#cc1111" stroke-width="3"></circle>
      <circle cx="50" cy="50" r="20" stroke="#cc1111" stroke-width="2"></circle>
      <path d="M50 5 A45 45 0 0 1 89.1 72.5 L64 57.5 A20 20 0 0 0 50 30 Z" fill="#cc1111" opacity=".8"></path>
      <path d="M89.1 72.5 A45 45 0 0 1 10.9 72.5 L36 57.5 A20 20 0 0 0 64 57.5 Z" fill="#cc1111" opacity=".8"></path>
      <path d="M10.9 72.5 A45 45 0 0 1 50 5 L50 30 A20 20 0 0 0 36 57.5 Z" fill="#cc1111" opacity=".8"></path>
    </svg>
    SCP FOUNDATION
  </div>
  <div class="header-mid">
    БАЗА ДАННЫХ АНОМАЛЬНЫХ ОБЪЕКТОВ<br>
    <span style="color:var(--border2);">CLEARANCE REQUIRED /// UNAUTHORIZED ACCESS PROHIBITED</span>
  </div>
  <div class="header-right">
    <div class="access-badge ro" id="syncBadge" style="color: rgb(74, 154, 204); border-color: rgb(34, 68, 102);">☁ ОНЛАЙН</div>
    <div class="access-badge adm" id="accessBadge">● АДМИНИСТРАТОР О5</div>
    <button class="hbtn" onclick="openAuthModal()" id="authBtn" style="display: none;">⬡ ДОСТУП ПЕРСОНАЛА</button>
    <button class="hbtn danger" onclick="logout()" id="logoutBtn" style="display: inline-flex;">⬡ ВЫХОД</button>
  </div>
</header>

<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sb-head">
      <div class="sb-label">ОБЪЕКТЫ БАЗЫ</div>
      <input type="text" class="sb-search" placeholder="ПОИСК ОБЪЕКТА..." oninput="filterEntities(this.value)">
    </div>
    <div class="entity-list" id="entityList"><div class="ent active">
      <div class="ent-num">SCP-8344</div>
      <div class="ent-name">MiХАЛЫЧ/ЗАЛYПЫЧ</div>
      <span class="tbadge EUCLID">EUCLID</span>
      
    </div></div>
    <div class="sb-foot">
      <button class="sbtn danger" id="addEntityBtn" onclick="openNewEntityModal()" style="display: flex;">⊕ СОЗДАТЬ ОБЪЕКТ</button>
      <button class="sbtn" id="cloudBtn" onclick="openCloudSetup()" style="display: flex; margin-top: 6px; border-color: var(--amber-dim); color: var(--amber);">☁ НАСТРОЙКИ ОБЛАКА</button>
      <button class="sbtn" id="shareBtn" onclick="downloadForFriend()" style="display: flex; margin-top: 4px; border-color: rgb(34, 68, 102); color: rgb(74, 154, 204);">⬇ СКАЧАТЬ ДЛЯ ДРУГА</button>
      <div id="roNote" style="font-family: var(--mono); font-size: 9px; color: var(--text-dim); letter-spacing: 1px; text-align: center; line-height: 1.6; display: none;">УРОВЕНЬ ДОСТУПА: ТОЛЬКО ЧТЕНИЕ<br>ДЛЯ РЕДАКТИРОВАНИЯ — АВТОРИЗУЙТЕСЬ</div>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main" id="mainContent"><div class="doc-view"><div class="ro-banner">⚠ РЕЖИМ ТОЛЬКО ДЛЯ ЧТЕНИЯ // РЕДАКТИРОВАНИЕ ЗАПРЕЩЕНО // НЕСАНКЦИОНИРОВАННОЕ ИЗМЕНЕНИЕ ДАННЫХ ЯВЛЯЕТСЯ НАРУШЕНИЕМ ПРОТОКОЛА</div><div class="doc-header">
  <div class="doc-id-corner">DOC #8344-DRYR</div>
  <div class="dh-top">
    <div class="dh-logo">
      <svg width="50" height="50" viewBox="0 0 100 100" fill="none">
        <circle cx="50" cy="50" r="45" stroke="#cc1111" stroke-width="3"></circle>
        <circle cx="50" cy="50" r="20" stroke="#cc1111" stroke-width="2"></circle>
        <path d="M50 5 A45 45 0 0 1 89.1 72.5 L64 57.5 A20 20 0 0 0 50 30 Z" fill="#cc1111" opacity=".8"></path>
        <path d="M89.1 72.5 A45 45 0 0 1 10.9 72.5 L36 57.5 A20 20 0 0 0 64 57.5 Z" fill="#cc1111" opacity=".8"></path>
        <path d="M10.9 72.5 A45 45 0 0 1 50 5 L50 30 A20 20 0 0 0 36 57.5 Z" fill="#cc1111" opacity=".8"></path>
      </svg>
    </div>
    <div class="dh-info">
      <div class="dh-num">ОБЪЕКТ №: SCP-8344</div>
      <div class="dh-name">MiХАЛЫЧ/ЗАЛYПЫЧ</div>
    </div>
    <div class="dh-stamps">
      <div class="stamp cl">ЗАСЕКРЕЧЕНО</div>
      <div class="stamp re">ОГРАНИЧЕННЫЙ ДОСТУП</div>
    </div>
  </div>
  <div class="dh-meta">
    <div class="dh-cell">
      <div class="dh-cell-label">КЛАСС УГРОЗЫ</div>
      <div class="dh-cell-val">
        <span class="tbadge EUCLID">EUCLID</span>
      </div>
    </div>
    <div class="dh-cell">
      <div class="dh-cell-label">ИССЛЕДОВАТЕЛЬ</div>
      <div class="dh-cell-val">желтышериф</div>
    </div>
    <div class="dh-cell">
      <div class="dh-cell-label">МЕСТО СОДЕРЖАНИЯ</div>
      <div class="dh-cell-val">школа 523</div>
    </div>
    <div class="dh-cell">
      <div class="dh-cell-label">СТАТУС</div>
      <div class="dh-cell-val" style="color:var(--green);">ПОД КОНТРОЛЕМ</div>
    </div>
  </div></div><div class="panes"><div class="pane-full"><div class="md-out"><h1>Процедуры содержания</h1>
<ul>
<li>Объект SCP-8344 должен содержаться в мес</li>
</ul>
<h2>Описание</h2>
<p>SCP-8869 представляет собой по виду обычного рабочего в школе но это не так. может в школе он и простой может забавный мужик но то что он скрывает... его прозвище "залупыч" которое у него уже как второе имя появилось не просто так. он имеет широкий спектр своих способностей и многие из них нормально не изученны. данный объект умеет грамотно использовать свои залупы. также по рассказам одного очевидца на спине залYпыча есть большое колличество сисек и самое страшное в них то что вместо сосков на них залупы.</p>
<h2>История обнаружения</h2>
<blockquote>
<p>«однажды я захотел пойти в туалет на уроке вышел и пошел в него там я встретил необычайно толстого мужика который толи срал то ли дрочил и тогда я решил чуть чуть посмеяться хихикнул и на меня набросился он ЗАЛУПЫЧ» история одного из пострадавших.</p>
</blockquote>
<h2>Способности</h2>
<ul>
<li>Выпускать залуп шпионов. залупа на паучьих ножках с камерой.</li>
<li>Выпускать залупа дронов. </li>
<li>Выпускать ядовитых залупных медуз.</li>
<li>Использовать одну из своих залуп в качестве оружия</li>
<li>Может ударить по твоей залупе и отправить ее в другой город, а в будущем она станет шпионом.</li>
</ul>
<hr>
<h2>Уровень секретности: ██████</h2>
<h3>tЫ пoжaлeешь ecли встретишь zaЛyПЫЧa</h3>
</div></div></div></div></div>
</div>

<!-- AUTH MODAL -->
<div class="overlay" id="authOverlay">
  <div class="modal" style="width:350px;">
    <div class="mhd"><div class="mtitle">⬡ АВТОРИЗАЦИЯ ПЕРСОНАЛА</div><button class="mclose" onclick="closeModal('authOverlay')">✕</button></div>
    <div class="mbody">
      <div style="font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:2px;text-align:center;margin-bottom:18px;line-height:1.8;">ВВЕДИТЕ КОД ДОСТУПА<br><span style="color:var(--red-dim);">НЕСАНКЦИОНИРОВАННЫЙ ДОСТУП ФИКСИРУЕТСЯ</span></div>
      <div class="pass-disp" id="passDisplay"><span class="blink" style="color:var(--green-dim)">█</span></div>
      <div class="keypad" id="keypad"><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">7</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">8</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">9</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">4</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">5</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">6</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">1</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">2</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">3</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">⌫</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">0</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">↵</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">7</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">8</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">9</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">4</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">5</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">6</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">1</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">2</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">3</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">⌫</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">0</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">↵</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">7</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">8</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">9</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">4</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">5</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">6</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">1</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">2</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">3</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">⌫</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">0</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">↵</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">7</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">8</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">9</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">4</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">5</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">6</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">1</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">2</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">3</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">⌫</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">0</button><button class="mbtn c" style="font-size: 18px; padding: 12px; letter-spacing: 0px; font-family: var(--mono);">↵</button></div>
      <div class="pass-err" id="passError"></div>
    </div>
    <div class="mfoot">
      <button class="mbtn c" onclick="clearPass()">СБРОС</button>
      <button class="mbtn ok" onclick="attemptAuth()">ПОДТВЕРДИТЬ</button>
    </div>
  </div>
</div>

<!-- NEW ENTITY MODAL -->
<div class="overlay" id="newEntityOverlay">
  <div class="modal">
    <div class="mhd"><div class="mtitle">⊕ РЕГИСТРАЦИЯ НОВОГО ОБЪЕКТА</div><button class="mclose" onclick="closeModal('newEntityOverlay')">✕</button></div>
    <div class="mbody">
      <div class="frow"><label class="flabel">ОБОЗНАЧЕНИЕ ОБЪЕКТА</label><input type="text" class="finput" id="newName" placeholder="ИМЯ / НАЗВАНИЕ..."></div>
      <div class="frow">
        <label class="flabel">КЛАСС УГРОЗЫ</label>
        <select class="fsel" id="newThreat">
          <option value="SAFE">SAFE — БЕЗОПАСНЫЙ</option>
          <option value="EUCLID" selected="">EUCLID — ЕВКЛИД</option>
          <option value="KETER">KETER — КЕТЕР ⚠</option>
          <option value="THAUMIEL">THAUMIEL — ТАУМИЭЛЬ</option>
          <option value="NEUTRALIZED">NEUTRALIZED — НЕЙТРАЛИЗОВАН</option>
        </select>
      </div>
      <div class="frow"><label class="flabel">ОТВЕТСТВЕННЫЙ ИССЛЕДОВАТЕЛЬ</label><input type="text" class="finput" id="newResearcher" placeholder="Д-р ..."></div>
      <div class="frow"><label class="flabel">МЕСТО СОДЕРЖАНИЯ</label><input type="text" class="finput" id="newLocation" placeholder="ЗОНА-19, СЕКТОР-Б..."></div>
    </div>
    <div class="mfoot">
      <button class="mbtn c" onclick="closeModal('newEntityOverlay')">ОТМЕНА</button>
      <button class="mbtn ok" onclick="createEntity()">ЗАРЕГИСТРИРОВАТЬ</button>
    </div>
  </div>
</div>

<!-- IMAGE MODAL -->
<div class="overlay" id="imageOverlay">
  <div class="modal">
    <div class="mhd"><div class="mtitle">⬛ ВЛОЖИТЬ ИЗОБРАЖЕНИЕ / GIF</div><button class="mclose" onclick="closeModal('imageOverlay')">✕</button></div>
    <div class="mbody">
      <div class="tab-row">
        <button class="tabBtn active" onclick="switchImgTab('url')">ПО ССЫЛКЕ</button>
        <button class="tabBtn" onclick="switchImgTab('upload')">ЗАГРУЗИТЬ</button>
      </div>
      <div class="tab-p active" id="imgtab-url">
        <div class="frow"><label class="flabel">URL ИЗОБРАЖЕНИЯ / GIF</label><input type="url" class="finput" id="imgUrl" placeholder="https://..."></div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:1px;">.JPG .PNG .GIF .WEBP — GIPHY / TENOR</div>
      </div>
      <div class="tab-p" id="imgtab-upload">
        <div class="dzone" id="dropZone" onclick="document.getElementById('fileInput').click()">
          <input type="file" id="fileInput" accept="image/*,.gif" onchange="handleImgFile(event)">
          <div style="font-size:28px;margin-bottom:8px;">⬛</div>
          НАЖМИТЕ ИЛИ ПЕРЕТАЩИТЕ ФАЙЛ
        </div>
      </div>
      <div class="frow" style="margin-top:14px;"><label class="flabel">ПОДПИСЬ (необязательно)</label><input type="text" class="finput" id="imgCaption" placeholder="Фотография объекта..."></div>
    </div>
    <div class="mfoot">
      <button class="mbtn c" onclick="closeModal('imageOverlay')">ОТМЕНА</button>
      <button class="mbtn ok" onclick="insertImageMd()">ВСТАВИТЬ В ТЕКСТ</button>
    </div>
  </div>
</div>

<!-- CLOUD MODAL (только для админа) -->
<div class="overlay" id="cloudOverlay">
  <div class="modal" style="width:480px;">
    <div class="mhd">
      <div class="mtitle">☁ ПОДКЛЮЧЕНИЕ ОБЛАКА</div>
      <button class="mclose" onclick="closeModal('cloudOverlay')">✕</button>
    </div>
    <div class="mbody">
      <div style="font-family:var(--mono);font-size:11px;line-height:1.9;color:var(--text-dim);margin-bottom:18px;border-left:3px solid var(--red2);padding-left:12px;">
        Статьи будут храниться на <b style="color:var(--text);">jsonbin.io</b> — бесплатно.<br>
        После настройки нажми <b style="color:var(--amber);">⬇ СКАЧАТЬ ВЕРСИЮ ДЛЯ ДРУГА</b><br>
        — он просто откроет файл и увидит все статьи без каких-либо действий.<br><br>
        <b style="color:var(--text-bright);">Как получить ключ:</b><br>
        1. Открой <a href="https://jsonbin.io" target="_blank" style="color:var(--amber);">jsonbin.io</a> → Sign Up (бесплатно)<br>
        2. Перейди в профиль → <b>API Keys</b> → скопируй <b>Master Key</b>
      </div>
      <div class="frow">
        <label class="flabel">API MASTER KEY с jsonbin.io</label>
        <input type="text" class="finput" id="cloudKeyInput" placeholder="$2a$10$...">
      </div>
      <div id="cloudBinDisplay" style="font-family: var(--mono); font-size: 11px; color: var(--amber); letter-spacing: 1px; margin-top: 4px; padding: 6px; background: var(--bg2); border: 1px solid var(--border);">Ещё не создан — сохрани первую статью</div>
    </div>
    <div class="mfoot">
      <button class="mbtn c" onclick="closeModal('cloudOverlay')">ОТМЕНА</button>
      <button class="mbtn ok" onclick="applyCloudKey()">ПОДКЛЮЧИТЬ ☁</button>
    </div>
  </div>
</div>

<div class="toast" id="toast">// ДОСТУП РАЗРЕШЁН // УРОВЕНЬ О5</div>

<script>
// ═══════════════════════════════════════════
// ОБЛАКО — эти две строки заполняются автоматически
// ═══════════════════════════════════════════
const BAKED_KEY = '$2a$10$8xQx7Tq3cW4OCo58TZMbI.bWlY3eHmnC7A0bjouawrj8W/guIlpBq';      // ← вшитый ключ (для версии «другу»)
const BAKED_BIN = '69975e05ae596e708f38108f';      // ← вшитый bin id (для версии «другу»)
const ADMIN_PASS = 'root';

marked.setOptions({ breaks: true, gfm: true });

let isAdmin = false;
let entities = JSON.parse(localStorage.getItem('scp_db') || '[]');
let activeId = null;
let passBuffer = '';
let pendingImg = null;
let scpBase = 7000 + Math.floor(Math.random() * 2000);

// Ключ: сначала вшитый, потом из localStorage
let JB_KEY = BAKED_KEY || localStorage.getItem('scp_jbkey') || '';
let JB_BIN = BAKED_BIN || localStorage.getItem('scp_bin_id') || '';

window.addEventListener('load', () => {
  buildKeypad();
  if (JB_KEY && JB_BIN) {
    updateSyncBadge('syncing');
    cloudLoad().then(() => {
      setTimeout(() => { document.getElementById('bootScreen').style.display = 'none'; }, 3100);
    });
  } else {
    renderList();
    if (entities.length) selectEntity(entities[0].id);
    updateSyncBadge(JB_KEY ? 'key_only' : 'local');
    setTimeout(() => { document.getElementById('bootScreen').style.display = 'none'; }, 3100);
  }
});

// ═══════════════════════════════════════════
// AUTH
// ═══════════════════════════════════════════
function buildKeypad() {
  const kp = document.getElementById('keypad');
  ['7','8','9','4','5','6','1','2','3','⌫','0','↵'].forEach(k => {
    const b = document.createElement('button');
    b.textContent = k;
    b.className = 'mbtn c';
    Object.assign(b.style, { fontSize:'18px', padding:'12px', letterSpacing:'0', fontFamily:'var(--mono)' });
    b.onclick = () => kpPress(k);
    kp.appendChild(b);
  });
}

function kpPress(k) {
  if (k === '⌫') passBuffer = passBuffer.slice(0,-1);
  else if (k === '↵') { attemptAuth(); return; }
  else if (passBuffer.length < 20) passBuffer += k;
  refreshPassDisplay();
  document.getElementById('passError').textContent = '';
}

function refreshPassDisplay() {
  const d = document.getElementById('passDisplay');
  d.innerHTML = passBuffer ? '●'.repeat(passBuffer.length) : '<span class="blink" style="color:var(--green-dim)">█</span>';
}

function clearPass() { passBuffer = ''; refreshPassDisplay(); document.getElementById('passError').textContent = ''; }
function openAuthModal() { clearPass(); openOverlay('authOverlay'); }

function attemptAuth() {
  if (passBuffer !== ADMIN_PASS) {
    const e = document.getElementById('passError');
    e.textContent = '⚠ КОД ДОСТУПА НЕВЕРЕН — ИНЦИДЕНТ ЗАФИКСИРОВАН';
    e.classList.remove('shake'); void e.offsetWidth; e.classList.add('shake');
    clearPass(); return;
  }
  isAdmin = true;
  closeModal('authOverlay');
  document.getElementById('accessBadge').textContent = '● АДМИНИСТРАТОР О5';
  document.getElementById('accessBadge').className = 'access-badge adm';
  document.getElementById('authBtn').style.display = 'none';
  document.getElementById('logoutBtn').style.display = 'inline-flex';
  document.getElementById('addEntityBtn').style.display = 'flex';
  document.getElementById('cloudBtn').style.display = 'flex';
  document.getElementById('roNote').style.display = 'none';
  if (JB_BIN) { document.getElementById('shareBtn').style.display = 'flex'; showShareBtn(); }
  toast('ДОСТУП РАЗРЕШЁН // УРОВЕНЬ О5');
  if (activeId) renderDoc();
}

function logout() {
  isAdmin = false;
  document.getElementById('accessBadge').textContent = '● ТОЛЬКО ЧТЕНИЕ';
  document.getElementById('accessBadge').className = 'access-badge ro';
  document.getElementById('authBtn').style.display = 'inline-flex';
  document.getElementById('logoutBtn').style.display = 'none';
  document.getElementById('addEntityBtn').style.display = 'none';
  document.getElementById('cloudBtn').style.display = 'none';
  document.getElementById('shareBtn').style.display = 'none';
  const sb = document.getElementById('shareBtnWrap');
  if (sb) sb.remove();
  document.getElementById('roNote').style.display = 'block';
  toast('СЕССИЯ ЗАВЕРШЕНА');
  if (activeId) renderDoc();
}

document.addEventListener('keydown', ev => {
  if (!document.getElementById('authOverlay').classList.contains('open')) return;
  if (/^[a-zA-Z0-9]$/.test(ev.key)) { if (passBuffer.length < 20) { passBuffer += ev.key; refreshPassDisplay(); document.getElementById('passError').textContent=''; } }
  else if (ev.key === 'Backspace') kpPress('⌫');
  else if (ev.key === 'Enter') kpPress('↵');
});

// ═══════════════════════════════════════════
// ENTITY LIST
// ═══════════════════════════════════════════
function renderList(q = '') {
  const list = document.getElementById('entityList');
  list.innerHTML = '';
  const arr = q ? entities.filter(e => e.name.toLowerCase().includes(q.toLowerCase()) || e.number.includes(q)) : entities;
  arr.forEach(e => {
    const d = document.createElement('div');
    d.className = 'ent' + (e.id === activeId ? ' active' : '');
    d.onclick = () => selectEntity(e.id);
    d.innerHTML = `
      <div class="ent-num">SCP-${e.number}</div>
      <div class="ent-name">${esc(e.name)}</div>
      <span class="tbadge ${e.threat}">${e.threat}</span>
      ${isAdmin ? `<button class="ent-del" onclick="deleteEntity(event,'${e.id}')">✕</button>` : ''}
    `;
    list.appendChild(d);
  });
}

function filterEntities(q) { renderList(q); }

function selectEntity(id) {
  if (activeId && isAdmin) saveCurrent();
  activeId = id;
  renderList();
  renderDoc();
}

function openNewEntityModal() {
  if (!isAdmin) { toast('ДОСТУП ЗАПРЕЩЁН'); return; }
  ['newName','newResearcher','newLocation'].forEach(i => document.getElementById(i).value = '');
  openOverlay('newEntityOverlay');
}

function createEntity() {
  const name = document.getElementById('newName').value.trim();
  if (!name) { toast('ВВЕДИТЕ ОБОЗНАЧЕНИЕ ОБЪЕКТА'); return; }
  scpBase++;
  const entity = {
    id: 'e' + Date.now(),
    number: String(scpBase),
    name,
    threat: document.getElementById('newThreat').value,
    researcher: document.getElementById('newResearcher').value.trim() || 'ЗАСЕКРЕЧЕНО',
    location: document.getElementById('newLocation').value.trim() || 'ЗАСЕКРЕЧЕНО',
    markdown: `# Процедуры содержания\n\nОбъект SCP-${scpBase} должен содержаться в...\n\n## Описание\n\nSCP-${scpBase} представляет собой...\n\n## История обнаружения\n\n> «Это было нечто, чего мы не могли объяснить» — Д-р ...\n\n## Способности\n\n- Способность 1\n- Способность 2\n\n---\n\n**Уровень секретности:** ██████\n`
  };
  entities.push(entity);
  closeModal('newEntityOverlay');
  saveAll();
  renderList();
  selectEntity(entity.id);
}

function deleteEntity(ev, id) {
  ev.stopPropagation();
  if (!confirm('УДАЛИТЬ ОБЪЕКТ? ДЕЙСТВИЕ НЕОБРАТИМО.')) return;
  entities = entities.filter(x => x.id !== id);
  if (activeId === id) {
    activeId = null;
    document.getElementById('mainContent').innerHTML = `<div class="empty-state"><div class="sym">☣</div><h2>ОБЪЕКТ УДАЛЁН</h2><p>ЗАПИСЬ УНИЧТОЖЕНА ИЗ БАЗЫ ДАННЫХ</p></div>`;
  }
  saveAll(); renderList();
}

function getEntity(id) { return entities.find(e => e.id === id); }

// ═══════════════════════════════════════════
// DOC RENDER
// ═══════════════════════════════════════════
function renderDoc() {
  const entity = getEntity(activeId);
  if (!entity) return;
  const main = document.getElementById('mainContent');
  main.innerHTML = '';

  const view = document.createElement('div');
  view.className = 'doc-view';

  if (!isAdmin) {
    const banner = document.createElement('div');
    banner.className = 'ro-banner';
    banner.textContent = '⚠ РЕЖИМ ТОЛЬКО ДЛЯ ЧТЕНИЯ // РЕДАКТИРОВАНИЕ ЗАПРЕЩЕНО // НЕСАНКЦИОНИРОВАННОЕ ИЗМЕНЕНИЕ ДАННЫХ ЯВЛЯЕТСЯ НАРУШЕНИЕМ ПРОТОКОЛА';
    view.appendChild(banner);
  }

  // doc header
  const hdr = document.createElement('div');
  hdr.className = 'doc-header';
  hdr.innerHTML = buildHeader(entity);
  view.appendChild(hdr);

  // panes
  const panes = document.createElement('div');
  panes.className = 'panes';

  if (isAdmin) {
    // Write pane
    const wp = document.createElement('div');
    wp.className = 'pane-write';
    wp.innerHTML = `
      <div class="pane-label"><span>MARKDOWN — РЕДАКТОР</span><span style="color:var(--green-dim);">● РЕЖИМ ЗАПИСИ</span></div>
      <div class="md-bar" id="mdBar">${buildMdBarHtml()}</div>
      <textarea class="md-ta" id="mdTa" placeholder="# Заголовок раздела&#10;&#10;Начните писать статью на Markdown...&#10;&#10;## Раздел&#10;&#10;**Жирный**, *курсив*, \`код\`, ~~зачёркнутый~~&#10;&#10;> Цитата или показания&#10;&#10;- Список&#10;- Элементов">${esc(entity.markdown || '')}</textarea>
      <div class="md-hints">
        <code># H1</code><code>## H2</code><code>### H3</code>
        <code>**жирный**</code><code>*курсив*</code><code>~~зачёрк~~</code><code>\`код\`</code>
        <code>> цитата</code><code>- список</code><code>---</code><code>![alt](url)</code><code>| таблица |</code>
      </div>
    `;
    panes.appendChild(wp);

    // Preview pane
    const pp = document.createElement('div');
    pp.className = 'pane-preview';
    pp.innerHTML = `<div class="pane-label"><span>ПРЕДПРОСМОТР</span><span style="color:var(--amber-dim);">◉ LIVE</span></div>`;
    const scroll = document.createElement('div');
    scroll.className = 'pane-preview-scroll';
    const out = document.createElement('div');
    out.className = 'md-out';
    out.id = 'mdOut';
    scroll.appendChild(out);
    pp.appendChild(scroll);
    panes.appendChild(pp);

    view.appendChild(panes);
    main.appendChild(view);

    // setup textarea events
    const ta = document.getElementById('mdTa');
    ta.addEventListener('input', () => {
      entity.markdown = ta.value;
      renderPreview(ta.value);
    });
    ta.addEventListener('keydown', ev => {
      if (ev.key === 'Tab') {
        ev.preventDefault();
        const s = ta.selectionStart;
        ta.setRangeText('  ', s, s, 'end');
        entity.markdown = ta.value;
        renderPreview(ta.value);
      }
    });

    renderPreview(entity.markdown || '');

  } else {
    // Read-only full preview
    const fp = document.createElement('div');
    fp.className = 'pane-full';
    const out = document.createElement('div');
    out.className = 'md-out';
    out.innerHTML = entity.markdown
      ? marked.parse(entity.markdown)
      : '<div class="preview-hint">[ ДОКУМЕНТ ПУСТ ]<br>СОДЕРЖИМОЕ ОТСУТСТВУЕТ</div>';
    fp.appendChild(out);
    panes.appendChild(fp);
    view.appendChild(panes);
    main.appendChild(view);
  }
}

function renderPreview(md) {
  const out = document.getElementById('mdOut');
  if (!out) return;
  out.innerHTML = md ? marked.parse(md) : '<div class="preview-hint">НАЧНИТЕ ВВОДИТЬ ТЕКСТ СЛЕВА...</div>';
}

function buildHeader(entity) {
  const e = isAdmin;
  const statusColor = entity.threat==='NEUTRALIZED' ? '#666' : entity.threat==='KETER' ? 'var(--red)' : 'var(--green)';
  const statusText = entity.threat==='NEUTRALIZED' ? 'НЕЙТРАЛИЗОВАН' : entity.threat==='KETER' ? '⚠ АКТИВЕН' : 'ПОД КОНТРОЛЕМ';
  return `
  <div class="doc-id-corner">DOC #${entity.number}-${Date.now().toString(36).toUpperCase().slice(-4)}</div>
  <div class="dh-top">
    <div class="dh-logo">
      <svg width="50" height="50" viewBox="0 0 100 100" fill="none">
        <circle cx="50" cy="50" r="45" stroke="#cc1111" stroke-width="3"/>
        <circle cx="50" cy="50" r="20" stroke="#cc1111" stroke-width="2"/>
        <path d="M50 5 A45 45 0 0 1 89.1 72.5 L64 57.5 A20 20 0 0 0 50 30 Z" fill="#cc1111" opacity=".8"/>
        <path d="M89.1 72.5 A45 45 0 0 1 10.9 72.5 L36 57.5 A20 20 0 0 0 64 57.5 Z" fill="#cc1111" opacity=".8"/>
        <path d="M10.9 72.5 A45 45 0 0 1 50 5 L50 30 A20 20 0 0 0 36 57.5 Z" fill="#cc1111" opacity=".8"/>
      </svg>
    </div>
    <div class="dh-info">
      <div class="dh-num">ОБЪЕКТ №: SCP-${entity.number}</div>
      ${e ? `<input class="dh-name-input" type="text" value="${esc(entity.name)}" oninput="updateMeta('name',this.value)">` : `<div class="dh-name">${esc(entity.name)}</div>`}
    </div>
    <div class="dh-stamps">
      <div class="stamp cl">ЗАСЕКРЕЧЕНО</div>
      <div class="stamp re">ОГРАНИЧЕННЫЙ ДОСТУП</div>
    </div>
  </div>
  <div class="dh-meta">
    <div class="dh-cell">
      <div class="dh-cell-label">КЛАСС УГРОЗЫ</div>
      <div class="dh-cell-val">
        ${e ? `<select class="meta-sel" onchange="updateMeta('threat',this.value)">${['SAFE','EUCLID','KETER','THAUMIEL','NEUTRALIZED'].map(t=>`<option value="${t}" ${entity.threat===t?'selected':''}>${t}</option>`).join('')}</select>` : `<span class="tbadge ${entity.threat}">${entity.threat}</span>`}
      </div>
    </div>
    <div class="dh-cell">
      <div class="dh-cell-label">ИССЛЕДОВАТЕЛЬ</div>
      <div class="dh-cell-val">${e ? `<input class="meta-inp" type="text" value="${esc(entity.researcher||'')}" oninput="updateMeta('researcher',this.value)">` : esc(entity.researcher||'ЗАСЕКРЕЧЕНО')}</div>
    </div>
    <div class="dh-cell">
      <div class="dh-cell-label">МЕСТО СОДЕРЖАНИЯ</div>
      <div class="dh-cell-val">${e ? `<input class="meta-inp" type="text" value="${esc(entity.location||'')}" oninput="updateMeta('location',this.value)">` : esc(entity.location||'ЗАСЕКРЕЧЕНО')}</div>
    </div>
    <div class="dh-cell">
      <div class="dh-cell-label">СТАТУС</div>
      <div class="dh-cell-val" style="color:${statusColor};">${statusText}</div>
    </div>
  </div>`;
}

function updateMeta(field, value) {
  const entity = getEntity(activeId);
  if (!entity) return;
  entity[field] = value;
  renderList();
}

// ═══════════════════════════════════════════
// MARKDOWN TOOLBAR
// ═══════════════════════════════════════════
function buildMdBarHtml() {
  const items = [
    ['H1','wrapLine("# ","")'],['H2','wrapLine("## ","")'],['H3','wrapLine("### ","")'],
    ['SEP',null],
    ['<b>B</b>','wrapSel("**","**")'],['<i>I</i>','wrapSel("*","*")'],['<s>S</s>','wrapSel("~~","~~")'],
    ['`code`','wrapSel("`","`")'],['``` блок','wrapSel("```\\n","\\n```")'],
    ['SEP',null],
    ['❝ цитата','wrapLine("> ","")'],
    ['⚠ внимание','wrapLine("> ⚠ **ВНИМАНИЕ:** ","")'],
    ['• список','wrapLine("- ","")'],['1. нумер.','wrapLine("1. ","")'],
    ['SEP',null],
    ['⊞ таблица','insertTpl("| Колонка 1 | Колонка 2 | Колонка 3 |\\n|-----------|-----------|----------|\\n| Данные    | Данные    | Данные   |\\n")'],
    ['─── линия','insertTpl("\\n---\\n")'],
    ['SEP',null],
    ['🖼 картинка','openImgModal()'],
    ['🔗 ссылка','wrapSel("[","](url)")'],
  ];
  return items.map(([label, action]) => {
    if (label === 'SEP') return `<div class="mdb-sep"></div>`;
    return `<button class="mdb" onclick="${action}">${label}</button>`;
  }).join('');
}

// ═══════════════════════════════════════════
// MARKDOWN HELPERS
// ═══════════════════════════════════════════
function getTA() { return document.getElementById('mdTa'); }

function wrapSel(before, after) {
  const ta = getTA(); if (!ta) return;
  const s = ta.selectionStart, e = ta.selectionEnd;
  const sel = ta.value.slice(s, e) || 'текст';
  ta.setRangeText(before + sel + after, s, e, 'select');
  ta.focus();
  syncMd();
}

function wrapLine(prefix) {
  const ta = getTA(); if (!ta) return;
  const s = ta.selectionStart;
  const ls = ta.value.lastIndexOf('\n', s - 1) + 1;
  const le = ta.value.indexOf('\n', s);
  const end = le === -1 ? ta.value.length : le;
  ta.setRangeText(prefix + ta.value.slice(ls, end), ls, end, 'end');
  ta.focus();
  syncMd();
}

function insertTpl(tpl) {
  const ta = getTA(); if (!ta) return;
  const s = ta.selectionStart;
  ta.setRangeText(tpl, s, s, 'end');
  ta.focus();
  syncMd();
}

function syncMd() {
  const ta = getTA(); if (!ta) return;
  const entity = getEntity(activeId);
  if (entity) entity.markdown = ta.value;
  renderPreview(ta.value);
}

// ═══════════════════════════════════════════
// IMAGE
// ═══════════════════════════════════════════
function openImgModal() {
  pendingImg = null;
  document.getElementById('imgUrl').value = '';
  document.getElementById('imgCaption').value = '';
  document.getElementById('dropZone').innerHTML = `<input type="file" id="fileInput" accept="image/*,.gif" onchange="handleImgFile(event)"><div style="font-size:28px;margin-bottom:8px;">⬛</div>НАЖМИТЕ ИЛИ ПЕРЕТАЩИТЕ ФАЙЛ`;
  switchImgTab('url');
  openOverlay('imageOverlay');
  const dz = document.getElementById('dropZone');
  dz.ondragover = ev => { ev.preventDefault(); dz.classList.add('over'); };
  dz.ondragleave = () => dz.classList.remove('over');
  dz.ondrop = ev => { ev.preventDefault(); dz.classList.remove('over'); handleImgFiles(ev.dataTransfer.files); };
}

function handleImgFile(ev) { handleImgFiles(ev.target.files); }

function handleImgFiles(files) {
  if (!files || !files[0]) return;
  const reader = new FileReader();
  reader.onload = ev => {
    pendingImg = ev.target.result;
    document.getElementById('dropZone').innerHTML = `<img src="${pendingImg}" style="max-height:90px;max-width:100%;border:1px solid var(--border);">`;
  };
  reader.readAsDataURL(files[0]);
}

function switchImgTab(tab) {
  document.querySelectorAll('.tabBtn').forEach((b, i) => b.classList.toggle('active', (i===0&&tab==='url')||(i===1&&tab==='upload')));
  document.getElementById('imgtab-url').classList.toggle('active', tab==='url');
  document.getElementById('imgtab-upload').classList.toggle('active', tab==='upload');
}

function insertImageMd() {
  const src = pendingImg || document.getElementById('imgUrl').value.trim();
  if (!src) { toast('УКАЖИТЕ ИСТОЧНИК ИЗОБРАЖЕНИЯ'); return; }
  const caption = document.getElementById('imgCaption').value.trim() || 'Материал объекта';
  closeModal('imageOverlay');
  insertTpl(`\n![${caption}](${src})\n`);
  toast('ИЗОБРАЖЕНИЕ ВСТАВЛЕНО');
}

// ═══════════════════════════════════════════
// SAVE & CLOUD SYNC
// ═══════════════════════════════════════════
function saveCurrent() {
  const entity = getEntity(activeId);
  if (!entity) return;
  const ta = document.getElementById('mdTa');
  if (ta) entity.markdown = ta.value;
  const ni = document.querySelector('.dh-name-input');
  if (ni) entity.name = ni.value;
}

function saveAll() {
  saveCurrent();
  localStorage.setItem('scp_db', JSON.stringify(entities));
  if (JB_KEY && JB_BIN) {
    cloudSave();
  } else if (JB_KEY) {
    // ключ есть, но bin ещё не создан — создаём
    cloudCreate();
  } else {
    toast('ДАННЫЕ СОХРАНЕНЫ ЛОКАЛЬНО');
  }
}

// ─── Загрузить из облака ───
async function cloudLoad() {
  try {
    const r = await fetch(`https://api.jsonbin.io/v3/b/${JB_BIN}/latest`, {
      headers: { 'X-Master-Key': JB_KEY, 'X-Bin-Meta': 'false' }
    });
    if (!r.ok) throw new Error(r.status);
    const data = await r.json();
    if (Array.isArray(data) && data.length > 0) {
      entities = data;
      localStorage.setItem('scp_db', JSON.stringify(entities));
    }
    updateSyncBadge('cloud');
  } catch(e) {
    updateSyncBadge('error');
    toast('ОШИБКА ЗАГРУЗКИ: ' + e.message);
  }
  renderList();
  if (entities.length) selectEntity(entities[0].id);
}

// ─── Создать bin при первом сохранении ───
async function cloudCreate() {
  updateSyncBadge('syncing');
  try {
    const r = await fetch('https://api.jsonbin.io/v3/b', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Master-Key': JB_KEY,
        'X-Bin-Name': 'scp-foundation-db',
        'X-Bin-Private': 'false'
      },
      body: JSON.stringify(entities)
    });
    if (!r.ok) throw new Error(r.status);
    const data = await r.json();
    JB_BIN = data.metadata.id;
    localStorage.setItem('scp_bin_id', JB_BIN);
    localStorage.setItem('scp_db', JSON.stringify(entities));
    updateSyncBadge('cloud');
    toast('☁ БАЗА СОЗДАНА НА СЕРВЕРЕ!');
    // Показываем кнопку "скачать для друга"
    showShareBtn();
  } catch(e) {
    updateSyncBadge('error');
    toast('ОШИБКА СОЗДАНИЯ БАЗЫ: ' + e.message);
  }
}

// ─── Сохранить в существующий bin ───
async function cloudSave() {
  updateSyncBadge('syncing');
  try {
    const r = await fetch(`https://api.jsonbin.io/v3/b/${JB_BIN}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'X-Master-Key': JB_KEY
      },
      body: JSON.stringify(entities)
    });
    if (!r.ok) throw new Error(r.status);
    localStorage.setItem('scp_db', JSON.stringify(entities));
    updateSyncBadge('cloud');
    toast('☁ СИНХРОНИЗИРОВАНО С СЕРВЕРОМ');
  } catch(e) {
    updateSyncBadge('error');
    toast('ОШИБКА СИНХРОНИЗАЦИИ: ' + e.message);
  }
}

// ─── Скачать версию для друга (с вшитыми ключами) ───
function downloadForFriend() {
  saveCurrent();
  let src = document.documentElement.outerHTML;
  src = src.replace("const BAKED_KEY = '$2a$10$8xQx7Tq3cW4OCo58TZMbI.bWlY3eHmnC7A0bjouawrj8W/guIlpBq';", `const BAKED_KEY = '${JB_KEY}';`);
  src = src.replace("const BAKED_BIN = '69975e05ae596e708f38108f';", `const BAKED_BIN = '${JB_BIN}';`);
  const blob = new Blob(['<!DOCTYPE html>\n' + src], { type: 'text/html;charset=utf-8' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'scp-database.html';
  a.click();
  toast('☁ ФАЙЛ ДЛЯ ДРУГА СКАЧАН');
}

// ─── Показать кнопку «Поделиться» после создания bin ───
function showShareBtn() {
  // Показываем кнопку в сайдбаре
  const sBtn = document.getElementById('shareBtn');
  if (sBtn && isAdmin) sBtn.style.display = 'flex';
  // Фиксированная кнопка внизу экрана
  if (document.getElementById('shareBtnWrap')) return;
  if (!isAdmin) return;
  const wrap = document.createElement('div');
  wrap.id = 'shareBtnWrap';
  wrap.style.cssText = 'position:fixed;bottom:20px;right:20px;z-index:200;';
  wrap.innerHTML = `<button onclick="downloadForFriend()" style="font-family:var(--mono);font-size:11px;padding:9px 16px;background:var(--bg2);border:1px solid #4a9acc;color:#4a9acc;cursor:pointer;letter-spacing:2px;text-transform:uppercase;">⬇ СКАЧАТЬ ДЛЯ ДРУГА</button>`;
  document.body.appendChild(wrap);
}

// ─── Настройки облака (в auth модале для админа) ───
function openCloudSetup() {
  if (!isAdmin) return;
  openOverlay('cloudOverlay');
  document.getElementById('cloudKeyInput').value = JB_KEY;
  const binEl = document.getElementById('cloudBinDisplay');
  if (binEl) {
    binEl.textContent = JB_BIN ? 'BIN ID: ' + JB_BIN : 'Ещё не создан — сохрани первую статью';
    binEl.style.color = JB_BIN ? 'var(--green)' : 'var(--amber)';
  }
}

function applyCloudKey() {
  const key = document.getElementById('cloudKeyInput').value.trim();
  if (!key) { toast('ВВЕДИТЕ API КЛЮЧ'); return; }
  JB_KEY = key;
  localStorage.setItem('scp_jbkey', key);
  closeModal('cloudOverlay');
  if (JB_BIN) {
    updateSyncBadge('syncing');
    cloudLoad();
    toast('☁ ПОДКЛЮЧЕНО — ЗАГРУЖАЮ БАЗУ...');
  } else {
    updateSyncBadge('key_only');
    toast('КЛЮЧ СОХРАНЁН — СОЗДАЙ СТАТЬЮ И СОХРАНИ (Ctrl+S)');
  }
}

// ─── Значок статуса ───
function updateSyncBadge(status) {
  const b = document.getElementById('syncBadge');
  if (!b) return;
  const map = {
    local:    { t:'● ЛОКАЛЬНО',      c:'var(--text-dim)',  bc:'var(--border2)' },
    key_only: { t:'⚡ КЛЮЧ ДОБАВЛЕН', c:'var(--amber)',     bc:'var(--amber-dim)' },
    syncing:  { t:'↻ СИНХР...',      c:'var(--amber)',     bc:'var(--amber-dim)' },
    cloud:    { t:'☁ ОНЛАЙН',        c:'#4a9acc',          bc:'#224466' },
    error:    { t:'✕ ОШИБКА СВЯЗИ',  c:'var(--red)',       bc:'var(--red2)' },
  };
  const s = map[status] || map.local;
  b.textContent = s.t;
  b.style.color = s.c;
  b.style.borderColor = s.bc;
  // Показать кнопку скачать если облако готово и мы admin
  if (status === 'cloud' && isAdmin && JB_BIN) showShareBtn();
}

setInterval(() => { if (activeId && isAdmin) saveAll(); }, 30000);

document.addEventListener('keydown', ev => {
  if (document.getElementById('authOverlay').classList.contains('open')) return;
  if ((ev.ctrlKey || ev.metaKey) && ev.key === 's') { ev.preventDefault(); if (isAdmin) saveAll(); }
});

// ═══════════════════════════════════════════
// MODALS
// ═══════════════════════════════════════════
function openOverlay(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.overlay').forEach(o => o.addEventListener('click', ev => { if (ev.target===o) o.classList.remove('open'); }));

// ═══════════════════════════════════════════
// UTILS
// ═══════════════════════════════════════════
function esc(s) { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = '// ' + msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}
</script>


<div id="shareBtnWrap" style="position: fixed; bottom: 20px; right: 20px; z-index: 200;"><button onclick="downloadForFriend()" style="font-family:var(--mono);font-size:11px;padding:9px 16px;background:var(--bg2);border:1px solid #4a9acc;color:#4a9acc;cursor:pointer;letter-spacing:2px;text-transform:uppercase;">⬇ СКАЧАТЬ ДЛЯ ДРУГА</button></div></body></html>
