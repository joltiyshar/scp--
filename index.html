<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCP FOUNDATION â€” ĞĞ‘ĞªĞ•ĞšĞ¢ĞĞĞ¯ Ğ‘ĞĞ—Ğ Ğ”ĞĞĞĞ«Ğ¥</title>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Share+Tech+Mono&family=Courier+Prime:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
<style>
:root {
  --bg:#080808;--bg2:#0d0d0b;--surface:#111109;--surface2:#181815;
  --border:#2a2a24;--border2:#3d3d32;
  --text:#c8c4a8;--text-dim:#6b6858;--text-bright:#e0dcc4;
  --red:#cc1111;--red2:#991111;--red-dim:#4a0808;
  --amber:#c4920a;--amber-dim:#6b4f05;
  --green:#4a7a30;--green-dim:#1e3010;
  --mono:'Share Tech Mono','Courier New',monospace;
  --serif:'Courier Prime','Courier New',monospace;
  --title:'Special Elite','Courier New',monospace;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;}
body{background:var(--bg);color:var(--text);font-family:var(--serif);font-size:15px;overflow:hidden;cursor:crosshair;}

/* scanlines */
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.08) 2px,rgba(0,0,0,.08) 4px);pointer-events:none;z-index:9998;}
/* noise */
body::before{content:'';position:fixed;inset:-50%;width:200%;height:200%;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");animation:noise .4s steps(1) infinite;pointer-events:none;z-index:9997;opacity:.4;}
@keyframes noise{0%,100%{transform:translate(0,0)}10%{transform:translate(-2px,1px)}20%{transform:translate(2px,-1px)}30%{transform:translate(-1px,2px)}40%{transform:translate(1px,-2px)}50%{transform:translate(-2px,-1px)}60%{transform:translate(2px,2px)}70%{transform:translate(-1px,-1px)}80%{transform:translate(1px,1px)}90%{transform:translate(0,-2px)}}

/* BOOT */
#bootScreen{position:fixed;inset:0;background:#000;z-index:9000;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:var(--mono);font-size:13px;color:#cc1111;}
.boot-logo{font-size:52px;margin-bottom:20px;letter-spacing:6px;}
.boot-line{color:#555;margin:2px 0;}.boot-line.ok{color:#4a7a30;}.boot-line.warn{color:var(--amber);}
.blink{animation:blink 1s step-end infinite;}
@keyframes blink{50%{opacity:0;}}

/* HEADER */
header{height:56px;background:var(--bg2);border-bottom:2px solid var(--border);display:flex;align-items:center;padding:0 20px;gap:16px;z-index:100;flex-shrink:0;}
.scp-logo{font-family:var(--title);font-size:20px;color:var(--red);letter-spacing:3px;display:flex;align-items:center;gap:10px;white-space:nowrap;}
.header-mid{flex:1;font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:1px;line-height:1.6;}
.header-right{display:flex;align-items:center;gap:10px;}
.access-badge{font-family:var(--mono);font-size:10px;padding:4px 10px;border:1px solid;letter-spacing:2px;}
.access-badge.ro{color:var(--text-dim);border-color:var(--border2);}
.access-badge.adm{color:var(--amber);border-color:var(--amber-dim);animation:pAmber 2s ease infinite;}
@keyframes pAmber{0%,100%{box-shadow:0 0 4px rgba(196,146,10,.3)}50%{box-shadow:0 0 12px rgba(196,146,10,.7)}}
.hbtn{display:inline-flex;align-items:center;gap:4px;padding:5px 10px;border:1px solid var(--border2);background:transparent;color:var(--text-dim);font-family:var(--mono);font-size:10px;cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .15s;}
.hbtn:hover{border-color:var(--red2);color:var(--red);}
.hbtn.danger{border-color:var(--red2);color:var(--red);}
.hbtn.danger:hover{background:var(--red-dim);}

/* LAYOUT */
.app{display:flex;height:calc(100vh - 56px);overflow:hidden;}

/* SIDEBAR */
.sidebar{width:268px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;overflow:hidden;}
.sb-head{padding:12px 16px;border-bottom:1px solid var(--border);background:var(--bg2);}
.sb-label{font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;display:flex;align-items:center;gap:6px;}
.sb-label::before{content:'';width:6px;height:6px;background:var(--red);animation:pRed 1.5s ease infinite;}
@keyframes pRed{0%,100%{opacity:1;box-shadow:0 0 4px var(--red)}50%{opacity:.3;}}
.sb-search{background:transparent;border:1px solid var(--border);color:var(--text);font-family:var(--mono);font-size:12px;padding:6px 10px;width:100%;outline:none;letter-spacing:1px;}
.sb-search:focus{border-color:var(--red2);}.sb-search::placeholder{color:var(--text-dim);}
.entity-list{flex:1;overflow-y:auto;padding:6px 0;}
.entity-list::-webkit-scrollbar{width:4px;}.entity-list::-webkit-scrollbar-thumb{background:var(--border2);}
.ent{padding:10px 16px;cursor:pointer;border-left:3px solid transparent;border-bottom:1px solid rgba(42,42,36,.5);transition:all .15s;position:relative;}
.ent:hover{background:var(--surface2);border-left-color:var(--border2);}
.ent.active{background:var(--surface2);border-left-color:var(--red);}
.ent-num{font-family:var(--mono);font-size:10px;color:var(--text-dim);margin-bottom:3px;letter-spacing:1px;}
.ent-name{font-family:var(--title);font-size:14px;color:var(--text-bright);margin-bottom:4px;}
.ent-name:hover{animation:glitch .3s linear;}
@keyframes glitch{0%,100%{text-shadow:none}20%{text-shadow:-2px 0 var(--red)}50%{text-shadow:2px 0 var(--amber)}80%{text-shadow:-1px 0 rgba(100,200,255,.5)}}
.tbadge{display:inline-block;font-family:var(--mono);font-size:9px;padding:1px 6px;letter-spacing:2px;font-weight:bold;}
.tbadge.SAFE{background:var(--green-dim);color:#6ab040;border:1px solid var(--green);}
.tbadge.EUCLID{background:#4a3800;color:#c4920a;border:1px solid var(--amber-dim);}
.tbadge.KETER{background:var(--red-dim);color:#ff4444;border:1px solid var(--red2);animation:gRed 2s ease infinite;}
.tbadge.THAUMIEL{background:#0a1a3a;color:#4488cc;border:1px solid #224466;}
.tbadge.NEUTRALIZED{background:#1a1a1a;color:#666;border:1px solid #333;text-decoration:line-through;}
@keyframes gRed{0%,100%{box-shadow:0 0 4px rgba(204,17,17,.4)}50%{box-shadow:0 0 10px rgba(204,17,17,.8)}}
.ent-del{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--red2);cursor:pointer;font-size:13px;opacity:0;transition:opacity .15s;padding:4px;}
.ent:hover .ent-del{opacity:1;}
.sb-foot{padding:12px 16px;border-top:1px solid var(--border);background:var(--bg2);}
.sbtn{display:flex;align-items:center;justify-content:center;gap:6px;padding:7px 14px;border:1px solid var(--border2);background:transparent;color:var(--text-dim);font-family:var(--mono);font-size:11px;cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .15s;width:100%;}
.sbtn:hover{border-color:var(--red2);color:var(--red);}
.sbtn.danger{border-color:var(--red2);color:var(--red);}
.sbtn.danger:hover{background:var(--red-dim);box-shadow:0 0 10px rgba(204,17,17,.3);}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-dim);font-family:var(--mono);text-align:center;padding:40px;gap:12px;}
.empty-state .sym{font-size:80px;opacity:.07;filter:blur(1px);margin-bottom:10px;}
.empty-state h2{font-family:var(--title);font-size:20px;color:var(--border2);letter-spacing:3px;}
.empty-state p{font-size:12px;letter-spacing:1px;opacity:.6;max-width:360px;line-height:1.8;}

/* DOC VIEW */
.doc-view{flex:1;display:flex;flex-direction:column;overflow:hidden;animation:fslide .25s ease;}
@keyframes fslide{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.ro-banner{background:var(--red-dim);border-bottom:1px solid var(--red2);padding:5px 20px;font-family:var(--mono);font-size:10px;color:#ff6666;letter-spacing:3px;text-transform:uppercase;text-align:center;flex-shrink:0;}

/* DOC HEADER */
.doc-header{background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0;position:relative;}
.doc-id-corner{position:absolute;top:8px;right:12px;font-family:var(--mono);font-size:9px;color:var(--border2);letter-spacing:2px;}
.dh-top{display:flex;align-items:stretch;border-bottom:1px solid var(--border);}
.dh-logo{padding:14px 18px;border-right:1px solid var(--border);display:flex;align-items:center;justify-content:center;background:var(--bg2);}
.dh-info{padding:10px 18px;flex:1;}
.dh-num{font-family:var(--title);font-size:26px;color:var(--red);letter-spacing:2px;margin-bottom:4px;}
.dh-name{font-family:var(--title);font-size:21px;color:var(--text-bright);letter-spacing:1px;}
.dh-name-input{font-family:var(--title)!important;font-size:21px!important;color:var(--text-bright)!important;background:transparent;border:none!important;border-bottom:1px dashed var(--border)!important;outline:none;width:100%;padding:0!important;}
.dh-stamps{padding:10px 14px;display:flex;gap:10px;align-items:center;border-right:1px solid var(--border);flex-direction:column;justify-content:center;}
.stamp{font-family:var(--title);font-size:10px;padding:3px 7px;border:2px solid;letter-spacing:2px;opacity:.85;white-space:nowrap;}
.stamp.cl{color:#b80000;border-color:#b80000;transform:rotate(3deg);}
.stamp.re{color:var(--amber);border-color:var(--amber-dim);transform:rotate(-4deg);}
.dh-meta{display:grid;grid-template-columns:repeat(4,1fr);}
.dh-cell{padding:7px 12px;border-right:1px solid var(--border);}
.dh-cell:last-child{border-right:none;}
.dh-cell-label{font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase;margin-bottom:3px;}
.dh-cell-val{font-family:var(--mono);font-size:12px;color:var(--text-bright);}
.meta-inp{background:transparent;border:none;border-bottom:1px dashed var(--border);color:var(--text-bright);font-family:var(--mono);font-size:12px;outline:none;width:100%;}
.meta-sel{background:transparent;border:none;border-bottom:1px dashed var(--border);color:var(--text-bright);font-family:var(--mono);font-size:12px;outline:none;width:100%;cursor:pointer;}
.meta-sel option{background:var(--surface2);}

/* EDITOR PANES */
.panes{flex:1;display:flex;overflow:hidden;}

/* WRITE PANE */
.pane-write{flex:1;display:flex;flex-direction:column;border-right:1px solid var(--border);min-width:0;}
.pane-label{padding:5px 14px;background:var(--bg2);border-bottom:1px solid var(--border);font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:3px;text-transform:uppercase;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}

/* MARKDOWN TOOLBAR */
.md-bar{padding:5px 8px;background:var(--surface);border-bottom:1px solid var(--border);display:flex;gap:3px;flex-wrap:wrap;align-items:center;flex-shrink:0;}
.mdb{font-family:var(--mono);font-size:11px;padding:3px 7px;border:1px solid var(--border);background:transparent;color:var(--text-dim);cursor:pointer;letter-spacing:.5px;transition:all .1s;white-space:nowrap;}
.mdb:hover{border-color:var(--red2);color:var(--red);background:var(--red-dim);}
.mdb-sep{width:1px;height:16px;background:var(--border);margin:0 3px;}

/* TEXTAREA */
.md-ta{flex:1;background:var(--bg2);color:var(--text);font-family:var(--mono);font-size:13px;line-height:1.85;padding:18px 22px;border:none;outline:none;resize:none;tab-size:2;caret-color:var(--red);}
.md-ta::placeholder{color:var(--text-dim);font-style:italic;}
.md-ta::-webkit-scrollbar{width:5px;}.md-ta::-webkit-scrollbar-thumb{background:var(--border2);}

/* HINT BAR */
.md-hints{padding:6px 14px;background:var(--bg2);border-top:1px solid var(--border);font-family:var(--mono);font-size:10px;color:var(--text-dim);display:flex;gap:14px;flex-wrap:wrap;flex-shrink:0;}
.md-hints code{color:var(--border2);background:none;font-size:10px;}

/* PREVIEW PANE */
.pane-preview{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;}
.pane-preview-scroll{flex:1;overflow-y:auto;padding:20px 28px;}
.pane-preview-scroll::-webkit-scrollbar{width:5px;}.pane-preview-scroll::-webkit-scrollbar-thumb{background:var(--border2);}

/* FULL PREVIEW (read-only) */
.pane-full{flex:1;overflow-y:auto;padding:28px 40px;}
.pane-full::-webkit-scrollbar{width:6px;}.pane-full::-webkit-scrollbar-thumb{background:var(--border2);}

/* â•â• MARKDOWN RENDERED STYLES â•â• */
.md-out{font-family:var(--serif);font-size:15px;color:var(--text);line-height:1.9;}
.md-out h1{font-family:var(--title);font-size:22px;color:var(--text-bright);letter-spacing:3px;text-transform:uppercase;border-bottom:1px solid var(--border);padding-bottom:8px;margin:20px 0 10px;}
.md-out h2{font-family:var(--title);font-size:16px;color:var(--text-bright);letter-spacing:3px;text-transform:uppercase;margin:20px 0 6px;background:var(--red-dim);border-left:4px solid var(--red);padding:7px 14px;}
.md-out h3{font-family:var(--mono);font-size:13px;color:var(--amber);letter-spacing:3px;text-transform:uppercase;margin:14px 0 6px;padding-left:10px;border-left:2px solid var(--amber-dim);}
.md-out h4{font-family:var(--mono);font-size:12px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase;margin:10px 0 4px;}
.md-out h5,.md-out h6{font-family:var(--mono);font-size:11px;color:var(--border2);letter-spacing:2px;margin:8px 0 4px;}
.md-out p{margin:8px 0;}
.md-out strong{color:var(--text-bright);}
.md-out em{color:var(--text-dim);font-style:italic;}
.md-out del{color:var(--text-dim);text-decoration:line-through;}
.md-out a{color:var(--amber);text-decoration:none;border-bottom:1px dashed var(--amber-dim);}
.md-out a:hover{color:var(--text-bright);}
.md-out code{font-family:var(--mono);font-size:12px;background:rgba(0,0,0,.5);color:#88cc88;padding:1px 5px;border:1px solid var(--border);}
.md-out pre{background:#000;border:1px solid var(--border);border-left:3px solid var(--red2);padding:14px 18px;overflow-x:auto;margin:12px 0;}
.md-out pre code{background:none;border:none;padding:0;font-size:12px;color:#88cc88;display:block;}
.md-out blockquote{border-left:4px solid var(--border2);margin:12px 0;padding:8px 16px;background:rgba(0,0,0,.3);color:var(--text-dim);font-style:italic;}
.md-out blockquote p{margin:0;}
.md-out ul,.md-out ol{padding-left:24px;margin:8px 0;}
.md-out li{margin:4px 0;}
.md-out li::marker{color:var(--red2);}
.md-out table{width:100%;border-collapse:collapse;margin:12px 0;font-family:var(--mono);font-size:12px;}
.md-out th{background:var(--surface2);border:1px solid var(--border);padding:7px 12px;color:var(--text-bright);letter-spacing:1px;text-align:left;}
.md-out td{border:1px solid var(--border);padding:6px 12px;}
.md-out tr:nth-child(even) td{background:rgba(0,0,0,.2);}
.md-out hr{border:none;border-top:1px solid var(--border);margin:24px 0;position:relative;}
.md-out hr::after{content:'â¬¥  â¬¥  â¬¥';position:absolute;left:50%;transform:translateX(-50%);top:-9px;background:var(--bg);padding:0 12px;color:var(--border2);font-size:11px;letter-spacing:6px;}
.md-out img{max-width:100%;border:1px solid var(--border);display:block;margin:12px auto;filter:contrast(1.05) brightness(.9);}
.preview-hint{font-family:var(--mono);font-size:11px;color:var(--text-dim);letter-spacing:2px;opacity:.35;text-align:center;padding:40px 20px;line-height:2;}

/* MODAL */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:500;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .2s;backdrop-filter:blur(2px);}
.overlay.open{opacity:1;pointer-events:all;}
.modal{background:var(--surface);border:1px solid var(--border2);width:460px;max-width:96vw;transform:scale(.96);transition:transform .2s;box-shadow:0 0 40px rgba(204,17,17,.1),0 0 80px rgba(0,0,0,.8);}
.overlay.open .modal{transform:scale(1);}
.mhd{background:var(--bg2);border-bottom:1px solid var(--border);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;}
.mtitle{font-family:var(--title);font-size:14px;color:var(--red);letter-spacing:3px;text-transform:uppercase;}
.mclose{background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:16px;font-family:var(--mono);}
.mclose:hover{color:var(--red);}
.mbody{padding:22px;}
.mfoot{padding:12px 20px;border-top:1px solid var(--border);background:var(--bg2);display:flex;gap:10px;justify-content:flex-end;}
.mbtn{font-family:var(--mono);font-size:11px;padding:7px 18px;border:1px solid;cursor:pointer;letter-spacing:2px;text-transform:uppercase;background:transparent;transition:all .15s;}
.mbtn.c{border-color:var(--border2);color:var(--text-dim);}
.mbtn.c:hover{color:var(--text);}
.mbtn.ok{border-color:var(--red2);color:var(--red);}
.mbtn.ok:hover{background:var(--red-dim);}
.flabel{font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:3px;text-transform:uppercase;margin-bottom:6px;display:block;}
.frow{margin-bottom:16px;}
.finput{background:var(--bg2);border:1px solid var(--border);color:var(--text-bright);font-family:var(--mono);font-size:14px;padding:8px 12px;outline:none;width:100%;letter-spacing:1px;transition:border-color .15s;}
.finput:focus{border-color:var(--red2);box-shadow:0 0 8px rgba(204,17,17,.2);}
.finput::placeholder{color:var(--text-dim);font-style:italic;}
.fsel{background:var(--bg2);border:1px solid var(--border);color:var(--text-bright);font-family:var(--mono);font-size:12px;padding:8px 12px;outline:none;width:100%;cursor:pointer;}
.fsel option{background:var(--surface2);}
.fsel:focus{border-color:var(--red2);}

/* PASS MODAL */
.pass-disp{font-family:var(--mono);font-size:24px;letter-spacing:8px;color:var(--green);text-align:center;padding:16px;background:#000;border:1px solid var(--green-dim);min-height:60px;display:flex;align-items:center;justify-content:center;}
.pass-err{font-family:var(--mono);font-size:11px;color:var(--red);letter-spacing:2px;text-align:center;min-height:18px;margin-top:6px;}
.pass-err.shake{animation:shake .3s ease;}
@keyframes shake{0%,100%{transform:none}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;margin-top:12px;}

/* IMAGE TABS */
.tab-row{display:flex;gap:4px;margin-bottom:14px;}
.tabBtn{font-family:var(--mono);font-size:10px;padding:5px 12px;border:1px solid var(--border);background:none;color:var(--text-dim);cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .12s;}
.tabBtn.active{border-color:var(--red2);color:var(--red);background:var(--red-dim);}
.tab-p{display:none;}.tab-p.active{display:block;}
.dzone{border:2px dashed var(--border);padding:28px;text-align:center;color:var(--text-dim);font-family:var(--mono);font-size:11px;letter-spacing:2px;cursor:pointer;transition:all .2s;background:var(--bg2);}
.dzone:hover,.dzone.over{border-color:var(--red2);color:var(--red);background:var(--red-dim);}
.dzone input{display:none;}

/* TOAST */
.toast{position:fixed;bottom:20px;right:20px;background:var(--surface2);border:1px solid var(--border2);border-left:4px solid var(--red);font-family:var(--mono);font-size:11px;color:var(--text);padding:10px 16px;letter-spacing:2px;text-transform:uppercase;z-index:9990;transform:translateX(130%);transition:transform .25s;max-width:320px;}
.toast.show{transform:none;}
</style>
</head>
<body>

<!-- BOOT -->
<div id="bootScreen">
  <div class="boot-logo">â˜£</div>
  <div class="boot-line">SCP FOUNDATION â€” SECURE CONTAIN PROTECT</div>
  <div class="boot-line" style="margin:8px 0;color:#1a1a14;">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</div>
  <div class="boot-line ok">[OK] Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ ĞŸĞ ĞĞ¢ĞĞšĞĞ›ĞĞ’ Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ˜</div>
  <div class="boot-line ok">[OK] ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¦Ğ•Ğ›ĞĞ¡Ğ¢ĞĞĞ¡Ğ¢Ğ˜ Ğ‘ĞĞ—Ğ« Ğ”ĞĞĞĞ«Ğ¥</div>
  <div class="boot-line warn">[!!] ĞĞ‘ĞĞĞ Ğ£Ğ–Ğ•ĞĞ« ĞĞĞĞœĞĞ›Ğ¬ĞĞ«Ğ• ĞĞ‘ĞªĞ•ĞšĞ¢Ğ«: Ğ¡Ğ’Ğ•Ğ ĞšĞ...</div>
  <div class="boot-line ok">[OK] Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞ: Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ§Ğ¢Ğ•ĞĞ˜Ğ•</div>
  <div class="boot-line ok">[OK] Ğ¢Ğ•ĞŸĞ•Ğ Ğ¬ Ğ¢Ğ« Ğ¨Ğ›Ğ®Ğ¥Ğ</div>
  <div class="boot-line" style="margin-top:16px;color:#2a2a24;font-size:11px;">Ğ”ĞĞ¡Ğ¢Ğ£ĞŸ Ğ ĞĞ—Ğ Ğ•Ğ¨ĞĞ <span class="blink">â–ˆ</span></div>
</div>

<!-- HEADER -->
<header>
  <div class="scp-logo">
    <svg width="32" height="32" viewBox="0 0 100 100" fill="none">
      <circle cx="50" cy="50" r="45" stroke="#cc1111" stroke-width="3"/>
      <circle cx="50" cy="50" r="20" stroke="#cc1111" stroke-width="2"/>
      <path d="M50 5 A45 45 0 0 1 89.1 72.5 L64 57.5 A20 20 0 0 0 50 30 Z" fill="#cc1111" opacity=".8"/>
      <path d="M89.1 72.5 A45 45 0 0 1 10.9 72.5 L36 57.5 A20 20 0 0 0 64 57.5 Z" fill="#cc1111" opacity=".8"/>
      <path d="M10.9 72.5 A45 45 0 0 1 50 5 L50 30 A20 20 0 0 0 36 57.5 Z" fill="#cc1111" opacity=".8"/>
    </svg>
    SCP FOUNDATION
  </div>
  <div class="header-mid">
    Ğ‘ĞĞ—Ğ Ğ”ĞĞĞĞ«Ğ¥ ĞĞĞĞœĞĞ›Ğ¬ĞĞ«Ğ¥ ĞĞ‘ĞªĞ•ĞšĞ¢ĞĞ’<br>
    <span style="color:var(--border2);">CLEARANCE REQUIRED /// UNAUTHORIZED ACCESS PROHIBITED</span>
  </div>
  <div class="header-right">
    <div class="access-badge ro" id="accessBadge">â— Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ§Ğ¢Ğ•ĞĞ˜Ğ•</div>
    <button class="hbtn" onclick="openAuthModal()" id="authBtn">â¬¡ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸ ĞŸĞ•Ğ Ğ¡ĞĞĞĞ›Ğ</button>
    <button class="hbtn danger" onclick="logout()" id="logoutBtn" style="display:none;">â¬¡ Ğ’Ğ«Ğ¥ĞĞ”</button>
  </div>
</header>

<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sb-head">
      <div class="sb-label">ĞĞ‘ĞªĞ•ĞšĞ¢Ğ« Ğ‘ĞĞ—Ğ«</div>
      <input type="text" class="sb-search" placeholder="ĞŸĞĞ˜Ğ¡Ğš ĞĞ‘ĞªĞ•ĞšĞ¢Ğ..." oninput="filterEntities(this.value)">
    </div>
    <div class="entity-list" id="entityList"></div>
    <div class="sb-foot">
      <button class="sbtn danger" id="addEntityBtn" onclick="openNewEntityModal()" style="display:none;">âŠ• Ğ¡ĞĞ—Ğ”ĞĞ¢Ğ¬ ĞĞ‘ĞªĞ•ĞšĞ¢</button>
      <div id="roNote" style="font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:1px;text-align:center;line-height:1.6;">Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞ: Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ§Ğ¢Ğ•ĞĞ˜Ğ•<br>Ğ”Ğ›Ğ¯ Ğ Ğ•Ğ”ĞĞšĞ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ¯ â€” ĞĞ’Ğ¢ĞĞ Ğ˜Ğ—Ğ£Ğ™Ğ¢Ğ•Ğ¡Ğ¬</div>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main" id="mainContent">
    <div class="empty-state">
      <div class="sym">â˜£</div>
      <h2>ĞĞ‘ĞªĞ•ĞšĞ¢ ĞĞ• Ğ’Ğ«Ğ‘Ğ ĞĞ</h2>
      <p>Ğ’Ğ«Ğ‘Ğ•Ğ Ğ˜Ğ¢Ğ• ĞĞ‘ĞªĞ•ĞšĞ¢ Ğ˜Ğ— Ğ¡ĞŸĞ˜Ğ¡ĞšĞ Ğ¡Ğ›Ğ•Ğ’Ğ<br><br>Ğ”Ğ›Ğ¯ Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ¯ ĞĞ‘ĞªĞ•ĞšĞ¢ĞĞ’ Ğ¢Ğ Ğ•Ğ‘Ğ£Ğ•Ğ¢Ğ¡Ğ¯ ĞŸĞĞ™Ğ¢Ğ˜ ĞĞĞ¥Ğ£Ğ™ </p>
    </div>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="overlay" id="authOverlay">
  <div class="modal" style="width:350px;">
    <div class="mhd"><div class="mtitle">â¬¡ ĞĞ’Ğ¢ĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ ĞŸĞ•Ğ Ğ¡ĞĞĞĞ›Ğ</div><button class="mclose" onclick="closeModal('authOverlay')">âœ•</button></div>
    <div class="mbody">
      <div style="font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:2px;text-align:center;margin-bottom:18px;line-height:1.8;">Ğ’Ğ’Ğ•Ğ”Ğ˜Ğ¢Ğ• ĞšĞĞ” Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞ<br><span style="color:var(--red-dim);">ĞĞ•Ğ¡ĞĞĞšĞ¦Ğ˜ĞĞĞ˜Ğ ĞĞ’ĞĞĞĞ«Ğ™ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸ Ğ¤Ğ˜ĞšĞ¡Ğ˜Ğ Ğ£Ğ•Ğ¢Ğ¡Ğ¯</span></div>
      <div class="pass-disp" id="passDisplay"><span class="blink" style="color:var(--green-dim);">â–ˆ</span></div>
      <div class="keypad" id="keypad"></div>
      <div class="pass-err" id="passError"></div>
    </div>
    <div class="mfoot">
      <button class="mbtn c" onclick="clearPass()">Ğ¡Ğ‘Ğ ĞĞ¡</button>
      <button class="mbtn ok" onclick="attemptAuth()">ĞŸĞĞ”Ğ¢Ğ’Ğ•Ğ Ğ”Ğ˜Ğ¢Ğ¬</button>
    </div>
  </div>
</div>

<!-- NEW ENTITY MODAL -->
<div class="overlay" id="newEntityOverlay">
  <div class="modal">
    <div class="mhd"><div class="mtitle">âŠ• Ğ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯ ĞĞĞ’ĞĞ“Ğ ĞĞ‘ĞªĞ•ĞšĞ¢Ğ</div><button class="mclose" onclick="closeModal('newEntityOverlay')">âœ•</button></div>
    <div class="mbody">
      <div class="frow"><label class="flabel">ĞĞ‘ĞĞ—ĞĞĞ§Ğ•ĞĞ˜Ğ• ĞĞ‘ĞªĞ•ĞšĞ¢Ğ</label><input type="text" class="finput" id="newName" placeholder="Ğ˜ĞœĞ¯ / ĞĞĞ—Ğ’ĞĞĞ˜Ğ•..."></div>
      <div class="frow">
        <label class="flabel">ĞšĞ›ĞĞ¡Ğ¡ Ğ£Ğ“Ğ ĞĞ—Ğ«</label>
        <select class="fsel" id="newThreat">
          <option value="SAFE">SAFE â€” Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞ«Ğ™</option>
          <option value="EUCLID" selected>EUCLID â€” Ğ•Ğ’ĞšĞ›Ğ˜Ğ”</option>
          <option value="KETER">KETER â€” ĞšĞ•Ğ¢Ğ•Ğ  âš </option>
          <option value="THAUMIEL">THAUMIEL â€” Ğ¢ĞĞ£ĞœĞ˜Ğ­Ğ›Ğ¬</option>
          <option value="NEUTRALIZED">NEUTRALIZED â€” ĞĞ•Ğ™Ğ¢Ğ ĞĞ›Ğ˜Ğ—ĞĞ’ĞĞ</option>
        </select>
      </div>
      <div class="frow"><label class="flabel">ĞĞ¢Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ•ĞĞĞ«Ğ™ Ğ˜Ğ¡Ğ¡Ğ›Ğ•Ğ”ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¬</label><input type="text" class="finput" id="newResearcher" placeholder="Ğ”-Ñ€ ..."></div>
      <div class="frow"><label class="flabel">ĞœĞ•Ğ¡Ğ¢Ğ Ğ¡ĞĞ”Ğ•Ğ Ğ–ĞĞĞ˜Ğ¯</label><input type="text" class="finput" id="newLocation" placeholder="Ğ—ĞĞĞ-19, Ğ¡Ğ•ĞšĞ¢ĞĞ -Ğ‘..."></div>
    </div>
    <div class="mfoot">
      <button class="mbtn c" onclick="closeModal('newEntityOverlay')">ĞĞ¢ĞœĞ•ĞĞ</button>
      <button class="mbtn ok" onclick="createEntity()">Ğ—ĞĞ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ Ğ˜Ğ ĞĞ’ĞĞ¢Ğ¬</button>
    </div>
  </div>
</div>

<!-- IMAGE MODAL -->
<div class="overlay" id="imageOverlay">
  <div class="modal">
    <div class="mhd"><div class="mtitle">â¬› Ğ’Ğ›ĞĞ–Ğ˜Ğ¢Ğ¬ Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ• / GIF</div><button class="mclose" onclick="closeModal('imageOverlay')">âœ•</button></div>
    <div class="mbody">
      <div class="tab-row">
        <button class="tabBtn active" onclick="switchImgTab('url')">ĞŸĞ Ğ¡Ğ¡Ğ«Ğ›ĞšĞ•</button>
        <button class="tabBtn" onclick="switchImgTab('upload')">Ğ—ĞĞ“Ğ Ğ£Ğ—Ğ˜Ğ¢Ğ¬</button>
      </div>
      <div class="tab-p active" id="imgtab-url">
        <div class="frow"><label class="flabel">URL Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ¯ / GIF</label><input type="url" class="finput" id="imgUrl" placeholder="https://..."></div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:1px;">.JPG .PNG .GIF .WEBP â€” GIPHY / TENOR</div>
      </div>
      <div class="tab-p" id="imgtab-upload">
        <div class="dzone" id="dropZone" onclick="document.getElementById('fileInput').click()">
          <input type="file" id="fileInput" accept="image/*,.gif" onchange="handleImgFile(event)">
          <div style="font-size:28px;margin-bottom:8px;">â¬›</div>
          ĞĞĞ–ĞœĞ˜Ğ¢Ğ• Ğ˜Ğ›Ğ˜ ĞŸĞ•Ğ Ğ•Ğ¢ĞĞ©Ğ˜Ğ¢Ğ• Ğ¤ĞĞ™Ğ›
        </div>
      </div>
      <div class="frow" style="margin-top:14px;"><label class="flabel">ĞŸĞĞ”ĞŸĞ˜Ğ¡Ğ¬ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</label><input type="text" class="finput" id="imgCaption" placeholder="Ğ¤Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°..."></div>
    </div>
    <div class="mfoot">
      <button class="mbtn c" onclick="closeModal('imageOverlay')">ĞĞ¢ĞœĞ•ĞĞ</button>
      <button class="mbtn ok" onclick="insertImageMd()">Ğ’Ğ¡Ğ¢ĞĞ’Ğ˜Ğ¢Ğ¬ Ğ’ Ğ¢Ğ•ĞšĞ¡Ğ¢</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ADMIN_PASS = 'root';

marked.setOptions({ breaks: true, gfm: true });

let isAdmin = false;
let entities = JSON.parse(localStorage.getItem('scp_db') || '[]');
let activeId = null;
let passBuffer = '';
let pendingImg = null;
let scpBase = 7000 + Math.floor(Math.random() * 2000);

window.addEventListener('load', () => {
  buildKeypad();
  renderList();
  if (entities.length) selectEntity(entities[0].id);
  setTimeout(() => { document.getElementById('bootScreen').style.display = 'none'; }, 3100);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildKeypad() {
  const kp = document.getElementById('keypad');
  ['7','8','9','4','5','6','1','2','3','âŒ«','0','â†µ'].forEach(k => {
    const b = document.createElement('button');
    b.textContent = k;
    b.className = 'mbtn c';
    Object.assign(b.style, { fontSize:'18px', padding:'12px', letterSpacing:'0', fontFamily:'var(--mono)' });
    b.onclick = () => kpPress(k);
    kp.appendChild(b);
  });
}

function kpPress(k) {
  if (k === 'âŒ«') passBuffer = passBuffer.slice(0,-1);
  else if (k === 'â†µ') { attemptAuth(); return; }
  else if (passBuffer.length < 20) passBuffer += k;
  refreshPassDisplay();
  document.getElementById('passError').textContent = '';
}

function refreshPassDisplay() {
  const d = document.getElementById('passDisplay');
  d.innerHTML = passBuffer ? 'â—'.repeat(passBuffer.length) : '<span class="blink" style="color:var(--green-dim)">â–ˆ</span>';
}

function clearPass() { passBuffer = ''; refreshPassDisplay(); document.getElementById('passError').textContent = ''; }
function openAuthModal() { clearPass(); openOverlay('authOverlay'); }

function attemptAuth() {
  if (passBuffer !== ADMIN_PASS) {
    const e = document.getElementById('passError');
    e.textContent = 'âš  ĞšĞĞ” Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞ ĞĞ•Ğ’Ğ•Ğ Ğ•Ğ â€” Ğ˜ĞĞ¦Ğ˜Ğ”Ğ•ĞĞ¢ Ğ—ĞĞ¤Ğ˜ĞšĞ¡Ğ˜Ğ ĞĞ’ĞĞ';
    e.classList.remove('shake'); void e.offsetWidth; e.classList.add('shake');
    clearPass(); return;
  }
  isAdmin = true;
  closeModal('authOverlay');
  document.getElementById('accessBadge').textContent = 'â— ĞĞ”ĞœĞ˜ĞĞ˜Ğ¡Ğ¢Ğ ĞĞ¢ĞĞ  Ğ5';
  document.getElementById('accessBadge').className = 'access-badge adm';
  document.getElementById('authBtn').style.display = 'none';
  document.getElementById('logoutBtn').style.display = 'inline-flex';
  document.getElementById('addEntityBtn').style.display = 'flex';
  document.getElementById('roNote').style.display = 'none';
  toast('Ğ”ĞĞ¡Ğ¢Ğ£ĞŸ Ğ ĞĞ—Ğ Ğ•Ğ¨ĞĞ // Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ Ğ5');
  if (activeId) renderDoc();
}

function logout() {
  isAdmin = false;
  document.getElementById('accessBadge').textContent = 'â— Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ§Ğ¢Ğ•ĞĞ˜Ğ•';
  document.getElementById('accessBadge').className = 'access-badge ro';
  document.getElementById('authBtn').style.display = 'inline-flex';
  document.getElementById('logoutBtn').style.display = 'none';
  document.getElementById('addEntityBtn').style.display = 'none';
  document.getElementById('roNote').style.display = 'block';
  toast('Ğ¡Ğ•Ğ¡Ğ¡Ğ˜Ğ¯ Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ');
  if (activeId) renderDoc();
}

document.addEventListener('keydown', ev => {
  if (!document.getElementById('authOverlay').classList.contains('open')) return;
  if (/^[a-zA-Z0-9]$/.test(ev.key)) { if (passBuffer.length < 20) { passBuffer += ev.key; refreshPassDisplay(); document.getElementById('passError').textContent=''; } }
  else if (ev.key === 'Backspace') kpPress('âŒ«');
  else if (ev.key === 'Enter') kpPress('â†µ');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENTITY LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderList(q = '') {
  const list = document.getElementById('entityList');
  list.innerHTML = '';
  const arr = q ? entities.filter(e => e.name.toLowerCase().includes(q.toLowerCase()) || e.number.includes(q)) : entities;
  arr.forEach(e => {
    const d = document.createElement('div');
    d.className = 'ent' + (e.id === activeId ? ' active' : '');
    d.onclick = () => selectEntity(e.id);
    d.innerHTML = `
      <div class="ent-num">SCP-${e.number}</div>
      <div class="ent-name">${esc(e.name)}</div>
      <span class="tbadge ${e.threat}">${e.threat}</span>
      ${isAdmin ? `<button class="ent-del" onclick="deleteEntity(event,'${e.id}')">âœ•</button>` : ''}
    `;
    list.appendChild(d);
  });
}

function filterEntities(q) { renderList(q); }

function selectEntity(id) {
  if (activeId && isAdmin) saveCurrent();
  activeId = id;
  renderList();
  renderDoc();
}

function openNewEntityModal() {
  if (!isAdmin) { toast('Ğ”ĞĞ¡Ğ¢Ğ£ĞŸ Ğ—ĞĞŸĞ Ğ•Ğ©ĞĞ'); return; }
  ['newName','newResearcher','newLocation'].forEach(i => document.getElementById(i).value = '');
  openOverlay('newEntityOverlay');
}

function createEntity() {
  const name = document.getElementById('newName').value.trim();
  if (!name) { toast('Ğ’Ğ’Ğ•Ğ”Ğ˜Ğ¢Ğ• ĞĞ‘ĞĞ—ĞĞĞ§Ğ•ĞĞ˜Ğ• ĞĞ‘ĞªĞ•ĞšĞ¢Ğ'); return; }
  scpBase++;
  const entity = {
    id: 'e' + Date.now(),
    number: String(scpBase),
    name,
    threat: document.getElementById('newThreat').value,
    researcher: document.getElementById('newResearcher').value.trim() || 'Ğ—ĞĞ¡Ğ•ĞšĞ Ğ•Ğ§Ğ•ĞĞ',
    location: document.getElementById('newLocation').value.trim() || 'Ğ—ĞĞ¡Ğ•ĞšĞ Ğ•Ğ§Ğ•ĞĞ',
    markdown: `# ĞŸÑ€Ğ¾Ñ†ĞµĞ´ÑƒÑ€Ñ‹ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ñ\n\nĞĞ±ÑŠĞµĞºÑ‚ SCP-${scpBase} Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒÑÑ Ğ²...\n\n## ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ\n\nSCP-${scpBase} Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ¾Ğ±Ğ¾Ğ¹...\n\n## Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ\n\n> Â«Ğ­Ñ‚Ğ¾ Ğ±Ñ‹Ğ»Ğ¾ Ğ½ĞµÑ‡Ñ‚Ğ¾, Ñ‡ĞµĞ³Ğ¾ Ğ¼Ñ‹ Ğ½Ğµ Ğ¼Ğ¾Ğ³Ğ»Ğ¸ Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ñ‚ÑŒÂ» â€” Ğ”-Ñ€ ...\n\n## Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸\n\n- Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ±Ğ½Ğ¾ÑÑ‚ÑŒ 1\n- Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ±Ğ½Ğ¾ÑÑ‚ÑŒ 2\n\n---\n\n**Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑĞµĞºÑ€ĞµÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸:** â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\n`
  };
  entities.push(entity);
  closeModal('newEntityOverlay');
  saveAll();
  renderList();
  selectEntity(entity.id);
}

function deleteEntity(ev, id) {
  ev.stopPropagation();
  if (!confirm('Ğ£Ğ”ĞĞ›Ğ˜Ğ¢Ğ¬ ĞĞ‘ĞªĞ•ĞšĞ¢? Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ• ĞĞ•ĞĞ‘Ğ ĞĞ¢Ğ˜ĞœĞ.')) return;
  entities = entities.filter(x => x.id !== id);
  if (activeId === id) {
    activeId = null;
    document.getElementById('mainContent').innerHTML = `<div class="empty-state"><div class="sym">â˜£</div><h2>ĞĞ‘ĞªĞ•ĞšĞ¢ Ğ£Ğ”ĞĞ›ĞĞ</h2><p>Ğ—ĞĞŸĞ˜Ğ¡Ğ¬ Ğ£ĞĞ˜Ğ§Ğ¢ĞĞ–Ğ•ĞĞ Ğ˜Ğ— Ğ‘ĞĞ—Ğ« Ğ”ĞĞĞĞ«Ğ¥</p></div>`;
  }
  saveAll(); renderList();
}

function getEntity(id) { return entities.find(e => e.id === id); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOC RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDoc() {
  const entity = getEntity(activeId);
  if (!entity) return;
  const main = document.getElementById('mainContent');
  main.innerHTML = '';

  const view = document.createElement('div');
  view.className = 'doc-view';

  if (!isAdmin) {
    const banner = document.createElement('div');
    banner.className = 'ro-banner';
    banner.textContent = 'âš  Ğ Ğ•Ğ–Ğ˜Ğœ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ”Ğ›Ğ¯ Ğ§Ğ¢Ğ•ĞĞ˜Ğ¯ // Ğ Ğ•Ğ”ĞĞšĞ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ // ĞĞ•Ğ¡ĞĞĞšĞ¦Ğ˜ĞĞĞ˜Ğ ĞĞ’ĞĞĞĞĞ• Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ• Ğ”ĞĞĞĞ«Ğ¥ Ğ¯Ğ’Ğ›Ğ¯Ğ•Ğ¢Ğ¡Ğ¯ ĞĞĞ Ğ£Ğ¨Ğ•ĞĞ˜Ğ•Ğœ ĞŸĞ ĞĞ¢ĞĞšĞĞ›Ğ';
    view.appendChild(banner);
  }

  // doc header
  const hdr = document.createElement('div');
  hdr.className = 'doc-header';
  hdr.innerHTML = buildHeader(entity);
  view.appendChild(hdr);

  // panes
  const panes = document.createElement('div');
  panes.className = 'panes';

  if (isAdmin) {
    // Write pane
    const wp = document.createElement('div');
    wp.className = 'pane-write';
    wp.innerHTML = `
      <div class="pane-label"><span>MARKDOWN â€” Ğ Ğ•Ğ”ĞĞšĞ¢ĞĞ </span><span style="color:var(--green-dim);">â— Ğ Ğ•Ğ–Ğ˜Ğœ Ğ—ĞĞŸĞ˜Ğ¡Ğ˜</span></div>
      <div class="md-bar" id="mdBar">${buildMdBarHtml()}</div>
      <textarea class="md-ta" id="mdTa" placeholder="# Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°&#10;&#10;ĞĞ°Ñ‡Ğ½Ğ¸Ñ‚Ğµ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑŒÑ Ğ½Ğ° Markdown...&#10;&#10;## Ğ Ğ°Ğ·Ğ´ĞµĞ»&#10;&#10;**Ğ–Ğ¸Ñ€Ğ½Ñ‹Ğ¹**, *ĞºÑƒÑ€ÑĞ¸Ğ²*, \`ĞºĞ¾Ğ´\`, ~~Ğ·Ğ°Ñ‡Ñ‘Ñ€ĞºĞ½ÑƒÑ‚Ñ‹Ğ¹~~&#10;&#10;> Ğ¦Ğ¸Ñ‚Ğ°Ñ‚Ğ° Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ&#10;&#10;- Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº&#10;- Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²">${esc(entity.markdown || '')}</textarea>
      <div class="md-hints">
        <code># H1</code><code>## H2</code><code>### H3</code>
        <code>**Ğ¶Ğ¸Ñ€Ğ½Ñ‹Ğ¹**</code><code>*ĞºÑƒÑ€ÑĞ¸Ğ²*</code><code>~~Ğ·Ğ°Ñ‡Ñ‘Ñ€Ğº~~</code><code>\`ĞºĞ¾Ğ´\`</code>
        <code>> Ñ†Ğ¸Ñ‚Ğ°Ñ‚Ğ°</code><code>- ÑĞ¿Ğ¸ÑĞ¾Ğº</code><code>---</code><code>![alt](url)</code><code>| Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° |</code>
      </div>
    `;
    panes.appendChild(wp);

    // Preview pane
    const pp = document.createElement('div');
    pp.className = 'pane-preview';
    pp.innerHTML = `<div class="pane-label"><span>ĞŸĞ Ğ•Ğ”ĞŸĞ ĞĞ¡ĞœĞĞ¢Ğ </span><span style="color:var(--amber-dim);">â—‰ LIVE</span></div>`;
    const scroll = document.createElement('div');
    scroll.className = 'pane-preview-scroll';
    const out = document.createElement('div');
    out.className = 'md-out';
    out.id = 'mdOut';
    scroll.appendChild(out);
    pp.appendChild(scroll);
    panes.appendChild(pp);

    view.appendChild(panes);
    main.appendChild(view);

    // setup textarea events
    const ta = document.getElementById('mdTa');
    ta.addEventListener('input', () => {
      entity.markdown = ta.value;
      renderPreview(ta.value);
    });
    ta.addEventListener('keydown', ev => {
      if (ev.key === 'Tab') {
        ev.preventDefault();
        const s = ta.selectionStart;
        ta.setRangeText('  ', s, s, 'end');
        entity.markdown = ta.value;
        renderPreview(ta.value);
      }
    });

    renderPreview(entity.markdown || '');

  } else {
    // Read-only full preview
    const fp = document.createElement('div');
    fp.className = 'pane-full';
    const out = document.createElement('div');
    out.className = 'md-out';
    out.innerHTML = entity.markdown
      ? marked.parse(entity.markdown)
      : '<div class="preview-hint">[ Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢ ĞŸĞ£Ğ¡Ğ¢ ]<br>Ğ¡ĞĞ”Ğ•Ğ Ğ–Ğ˜ĞœĞĞ• ĞĞ¢Ğ¡Ğ£Ğ¢Ğ¡Ğ¢Ğ’Ğ£Ğ•Ğ¢</div>';
    fp.appendChild(out);
    panes.appendChild(fp);
    view.appendChild(panes);
    main.appendChild(view);
  }
}

function renderPreview(md) {
  const out = document.getElementById('mdOut');
  if (!out) return;
  out.innerHTML = md ? marked.parse(md) : '<div class="preview-hint">ĞĞĞ§ĞĞ˜Ğ¢Ğ• Ğ’Ğ’ĞĞ”Ğ˜Ğ¢Ğ¬ Ğ¢Ğ•ĞšĞ¡Ğ¢ Ğ¡Ğ›Ğ•Ğ’Ğ...</div>';
}

function buildHeader(entity) {
  const e = isAdmin;
  const statusColor = entity.threat==='NEUTRALIZED' ? '#666' : entity.threat==='KETER' ? 'var(--red)' : 'var(--green)';
  const statusText = entity.threat==='NEUTRALIZED' ? 'ĞĞ•Ğ™Ğ¢Ğ ĞĞ›Ğ˜Ğ—ĞĞ’ĞĞ' : entity.threat==='KETER' ? 'âš  ĞĞšĞ¢Ğ˜Ğ’Ğ•Ğ' : 'ĞŸĞĞ” ĞšĞĞĞ¢Ğ ĞĞ›Ğ•Ğœ';
  return `
  <div class="doc-id-corner">DOC #${entity.number}-${Date.now().toString(36).toUpperCase().slice(-4)}</div>
  <div class="dh-top">
    <div class="dh-logo">
      <svg width="50" height="50" viewBox="0 0 100 100" fill="none">
        <circle cx="50" cy="50" r="45" stroke="#cc1111" stroke-width="3"/>
        <circle cx="50" cy="50" r="20" stroke="#cc1111" stroke-width="2"/>
        <path d="M50 5 A45 45 0 0 1 89.1 72.5 L64 57.5 A20 20 0 0 0 50 30 Z" fill="#cc1111" opacity=".8"/>
        <path d="M89.1 72.5 A45 45 0 0 1 10.9 72.5 L36 57.5 A20 20 0 0 0 64 57.5 Z" fill="#cc1111" opacity=".8"/>
        <path d="M10.9 72.5 A45 45 0 0 1 50 5 L50 30 A20 20 0 0 0 36 57.5 Z" fill="#cc1111" opacity=".8"/>
      </svg>
    </div>
    <div class="dh-info">
      <div class="dh-num">ĞĞ‘ĞªĞ•ĞšĞ¢ â„–: SCP-${entity.number}</div>
      ${e ? `<input class="dh-name-input" type="text" value="${esc(entity.name)}" oninput="updateMeta('name',this.value)">` : `<div class="dh-name">${esc(entity.name)}</div>`}
    </div>
    <div class="dh-stamps">
      <div class="stamp cl">Ğ—ĞĞ¡Ğ•ĞšĞ Ğ•Ğ§Ğ•ĞĞ</div>
      <div class="stamp re">ĞĞ“Ğ ĞĞĞ˜Ğ§Ğ•ĞĞĞ«Ğ™ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸ</div>
    </div>
  </div>
  <div class="dh-meta">
    <div class="dh-cell">
      <div class="dh-cell-label">ĞšĞ›ĞĞ¡Ğ¡ Ğ£Ğ“Ğ ĞĞ—Ğ«</div>
      <div class="dh-cell-val">
        ${e ? `<select class="meta-sel" onchange="updateMeta('threat',this.value)">${['SAFE','EUCLID','KETER','THAUMIEL','NEUTRALIZED'].map(t=>`<option value="${t}" ${entity.threat===t?'selected':''}>${t}</option>`).join('')}</select>` : `<span class="tbadge ${entity.threat}">${entity.threat}</span>`}
      </div>
    </div>
    <div class="dh-cell">
      <div class="dh-cell-label">Ğ˜Ğ¡Ğ¡Ğ›Ğ•Ğ”ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¬</div>
      <div class="dh-cell-val">${e ? `<input class="meta-inp" type="text" value="${esc(entity.researcher||'')}" oninput="updateMeta('researcher',this.value)">` : esc(entity.researcher||'Ğ—ĞĞ¡Ğ•ĞšĞ Ğ•Ğ§Ğ•ĞĞ')}</div>
    </div>
    <div class="dh-cell">
      <div class="dh-cell-label">ĞœĞ•Ğ¡Ğ¢Ğ Ğ¡ĞĞ”Ğ•Ğ Ğ–ĞĞĞ˜Ğ¯</div>
      <div class="dh-cell-val">${e ? `<input class="meta-inp" type="text" value="${esc(entity.location||'')}" oninput="updateMeta('location',this.value)">` : esc(entity.location||'Ğ—ĞĞ¡Ğ•ĞšĞ Ğ•Ğ§Ğ•ĞĞ')}</div>
    </div>
    <div class="dh-cell">
      <div class="dh-cell-label">Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡</div>
      <div class="dh-cell-val" style="color:${statusColor};">${statusText}</div>
    </div>
  </div>`;
}

function updateMeta(field, value) {
  const entity = getEntity(activeId);
  if (!entity) return;
  entity[field] = value;
  renderList();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MARKDOWN TOOLBAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildMdBarHtml() {
  const items = [
    ['H1','wrapLine("# ","")'],['H2','wrapLine("## ","")'],['H3','wrapLine("### ","")'],
    ['SEP',null],
    ['<b>B</b>','wrapSel("**","**")'],['<i>I</i>','wrapSel("*","*")'],['<s>S</s>','wrapSel("~~","~~")'],
    ['`code`','wrapSel("`","`")'],['``` Ğ±Ğ»Ğ¾Ğº','wrapSel("```\\n","\\n```")'],
    ['SEP',null],
    ['â Ñ†Ğ¸Ñ‚Ğ°Ñ‚Ğ°','wrapLine("> ","")'],
    ['âš  Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ','wrapLine("> âš  **Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•:** ","")'],
    ['â€¢ ÑĞ¿Ğ¸ÑĞ¾Ğº','wrapLine("- ","")'],['1. Ğ½ÑƒĞ¼ĞµÑ€.','wrapLine("1. ","")'],
    ['SEP',null],
    ['âŠ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°','insertTpl("| ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° 1 | ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° 2 | ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° 3 |\\n|-----------|-----------|----------|\\n| Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ    | Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ    | Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ   |\\n")'],
    ['â”€â”€â”€ Ğ»Ğ¸Ğ½Ğ¸Ñ','insertTpl("\\n---\\n")'],
    ['SEP',null],
    ['ğŸ–¼ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ°','openImgModal()'],
    ['ğŸ”— ÑÑÑ‹Ğ»ĞºĞ°','wrapSel("[","](url)")'],
  ];
  return items.map(([label, action]) => {
    if (label === 'SEP') return `<div class="mdb-sep"></div>`;
    return `<button class="mdb" onclick="${action}">${label}</button>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MARKDOWN HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getTA() { return document.getElementById('mdTa'); }

function wrapSel(before, after) {
  const ta = getTA(); if (!ta) return;
  const s = ta.selectionStart, e = ta.selectionEnd;
  const sel = ta.value.slice(s, e) || 'Ñ‚ĞµĞºÑÑ‚';
  ta.setRangeText(before + sel + after, s, e, 'select');
  ta.focus();
  syncMd();
}

function wrapLine(prefix) {
  const ta = getTA(); if (!ta) return;
  const s = ta.selectionStart;
  const ls = ta.value.lastIndexOf('\n', s - 1) + 1;
  const le = ta.value.indexOf('\n', s);
  const end = le === -1 ? ta.value.length : le;
  ta.setRangeText(prefix + ta.value.slice(ls, end), ls, end, 'end');
  ta.focus();
  syncMd();
}

function insertTpl(tpl) {
  const ta = getTA(); if (!ta) return;
  const s = ta.selectionStart;
  ta.setRangeText(tpl, s, s, 'end');
  ta.focus();
  syncMd();
}

function syncMd() {
  const ta = getTA(); if (!ta) return;
  const entity = getEntity(activeId);
  if (entity) entity.markdown = ta.value;
  renderPreview(ta.value);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IMAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openImgModal() {
  pendingImg = null;
  document.getElementById('imgUrl').value = '';
  document.getElementById('imgCaption').value = '';
  document.getElementById('dropZone').innerHTML = `<input type="file" id="fileInput" accept="image/*,.gif" onchange="handleImgFile(event)"><div style="font-size:28px;margin-bottom:8px;">â¬›</div>ĞĞĞ–ĞœĞ˜Ğ¢Ğ• Ğ˜Ğ›Ğ˜ ĞŸĞ•Ğ Ğ•Ğ¢ĞĞ©Ğ˜Ğ¢Ğ• Ğ¤ĞĞ™Ğ›`;
  switchImgTab('url');
  openOverlay('imageOverlay');
  const dz = document.getElementById('dropZone');
  dz.ondragover = ev => { ev.preventDefault(); dz.classList.add('over'); };
  dz.ondragleave = () => dz.classList.remove('over');
  dz.ondrop = ev => { ev.preventDefault(); dz.classList.remove('over'); handleImgFiles(ev.dataTransfer.files); };
}

function handleImgFile(ev) { handleImgFiles(ev.target.files); }

function handleImgFiles(files) {
  if (!files || !files[0]) return;
  const reader = new FileReader();
  reader.onload = ev => {
    pendingImg = ev.target.result;
    document.getElementById('dropZone').innerHTML = `<img src="${pendingImg}" style="max-height:90px;max-width:100%;border:1px solid var(--border);">`;
  };
  reader.readAsDataURL(files[0]);
}

function switchImgTab(tab) {
  document.querySelectorAll('.tabBtn').forEach((b, i) => b.classList.toggle('active', (i===0&&tab==='url')||(i===1&&tab==='upload')));
  document.getElementById('imgtab-url').classList.toggle('active', tab==='url');
  document.getElementById('imgtab-upload').classList.toggle('active', tab==='upload');
}

function insertImageMd() {
  const src = pendingImg || document.getElementById('imgUrl').value.trim();
  if (!src) { toast('Ğ£ĞšĞĞ–Ğ˜Ğ¢Ğ• Ğ˜Ğ¡Ğ¢ĞĞ§ĞĞ˜Ğš Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ¯'); return; }
  const caption = document.getElementById('imgCaption').value.trim() || 'ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ» Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°';
  closeModal('imageOverlay');
  insertTpl(`\n![${caption}](${src})\n`);
  toast('Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ• Ğ’Ğ¡Ğ¢ĞĞ’Ğ›Ğ•ĞĞ');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAVE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveCurrent() {
  const entity = getEntity(activeId);
  if (!entity) return;
  const ta = document.getElementById('mdTa');
  if (ta) entity.markdown = ta.value;
  const ni = document.querySelector('.dh-name-input');
  if (ni) entity.name = ni.value;
}

function saveAll() {
  saveCurrent();
  localStorage.setItem('scp_db', JSON.stringify(entities));
  toast('Ğ”ĞĞĞĞ«Ğ• Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ« Ğ’ Ğ‘ĞĞ—Ğ£');
}

setInterval(() => { if (activeId && isAdmin) saveAll(); }, 30000);

document.addEventListener('keydown', ev => {
  if (document.getElementById('authOverlay').classList.contains('open')) return;
  if ((ev.ctrlKey || ev.metaKey) && ev.key === 's') { ev.preventDefault(); if (isAdmin) saveAll(); }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openOverlay(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.overlay').forEach(o => o.addEventListener('click', ev => { if (ev.target===o) o.classList.remove('open'); }));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function esc(s) { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = '// ' + msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}
</script>
</body>
</html>
