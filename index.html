<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCP FOUNDATION ‚Äî –û–ë–™–ï–ö–¢–ù–ê–Ø –ë–ê–ó–ê –î–ê–ù–ù–´–•</title>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Share+Tech+Mono&family=Courier+Prime:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080808;
  --bg2: #0d0d0b;
  --surface: #111109;
  --surface2: #181815;
  --border: #2a2a24;
  --border2: #3d3d32;
  --text: #c8c4a8;
  --text-dim: #6b6858;
  --text-bright: #e0dcc4;
  --red: #cc1111;
  --red2: #991111;
  --red-dim: #4a0808;
  --amber: #c4920a;
  --amber-dim: #6b4f05;
  --green: #4a7a30;
  --green-dim: #1e3010;
  --stamp-red: #b80000;
  --stamp-red2: #8a0000;
  --mono: 'Share Tech Mono', 'Courier New', monospace;
  --serif: 'Courier Prime', 'Courier New', monospace;
  --title: 'Special Elite', 'Courier New', monospace;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

html, body { height: 100%; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--serif);
  font-size: 15px;
  overflow: hidden;
  cursor: crosshair;
}

/* SCANLINES */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.08) 2px,
    rgba(0,0,0,0.08) 4px
  );
  pointer-events: none;
  z-index: 9998;
}

/* NOISE */
body::before {
  content: '';
  position: fixed;
  inset: -50%;
  width: 200%;
  height: 200%;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  animation: noise 0.4s steps(1) infinite;
  pointer-events: none;
  z-index: 9997;
  opacity: 0.4;
}

@keyframes noise {
  0%,100% { transform: translate(0,0); }
  10% { transform: translate(-2px,1px); }
  20% { transform: translate(2px,-1px); }
  30% { transform: translate(-1px,2px); }
  40% { transform: translate(1px,-2px); }
  50% { transform: translate(-2px,-1px); }
  60% { transform: translate(2px,2px); }
  70% { transform: translate(-1px,-1px); }
  80% { transform: translate(1px,1px); }
  90% { transform: translate(0px,-2px); }
}

/* BOOT SCREEN */
#
Screen {
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 9000;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-family: var(--mono);
  font-size: 13px;
  color: #cc1111;
  animation: bootFade 0.4s ease 2.8s forwards;
}

@keyframes bootFade { to { opacity: 0; pointer-events: none; } }

.boot-logo {
  font-size: 48px;
  margin-bottom: 20px;
  letter-spacing: 6px;
  animation: flicker 0.1s step-end 5;
}

@keyframes flicker {
  0%,100% { opacity:1; } 50% { opacity:0; }
}

.boot-line { color: #666; margin: 2px 0; }
.boot-line.ok { color: #4a7a30; }
.boot-line.warn { color: var(--amber); }
.boot-line.err { color: var(--red); }

/* HEADER */
header {
  height: 56px;
  background: var(--bg2);
  border-bottom: 2px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 20px;
  gap: 16px;
  position: relative;
  z-index: 100;
  flex-shrink: 0;
}

.scp-logo {
  font-family: var(--title);
  font-size: 20px;
  color: var(--red);
  letter-spacing: 3px;
  display: flex;
  align-items: center;
  gap: 10px;
  white-space: nowrap;
}

.scp-logo svg { flex-shrink: 0; }

.header-mid {
  flex: 1;
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
  letter-spacing: 1px;
  line-height: 1.6;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 10px;
}

.access-badge {
  font-family: var(--mono);
  font-size: 10px;
  padding: 4px 10px;
  border: 1px solid;
  letter-spacing: 2px;
  text-transform: uppercase;
}

.access-badge.read-only { color: var(--text-dim); border-color: var(--border2); }
.access-badge.admin { color: var(--amber); border-color: var(--amber-dim); animation: pulseAmber 2s ease infinite; }

@keyframes pulseAmber {
  0%,100% { box-shadow: 0 0 4px rgba(196,146,10,0.3); }
  50% { box-shadow: 0 0 10px rgba(196,146,10,0.6); }
}

.blink { animation: blink 1s step-end infinite; }
@keyframes blink { 50% { opacity: 0; } }

/* LAYOUT */
.app-layout {
  display: flex;
  height: calc(100vh - 56px);
  overflow: hidden;
}

/* SIDEBAR */
.sidebar {
  width: 280px;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  overflow: hidden;
}

.sidebar-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  background: var(--bg2);
}

.sidebar-label {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.sidebar-label::before { content: ''; display: block; width: 6px; height: 6px; background: var(--red); animation: pulseRed 1.5s ease infinite; }

@keyframes pulseRed {
  0%,100% { opacity: 1; box-shadow: 0 0 4px var(--red); }
  50% { opacity: 0.3; }
}

.sidebar-search {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text);
  font-family: var(--mono);
  font-size: 12px;
  padding: 6px 10px;
  width: 100%;
  outline: none;
  letter-spacing: 1px;
}

.sidebar-search:focus { border-color: var(--red2); }
.sidebar-search::placeholder { color: var(--text-dim); }

.entity-list {
  flex: 1;
  overflow-y: auto;
  padding: 8px 0;
}

.entity-list::-webkit-scrollbar { width: 4px; }
.entity-list::-webkit-scrollbar-track { background: var(--bg2); }
.entity-list::-webkit-scrollbar-thumb { background: var(--border2); }

.entity-item {
  padding: 10px 16px;
  cursor: pointer;
  border-left: 3px solid transparent;
  border-bottom: 1px solid rgba(42,42,36,0.5);
  transition: all 0.15s;
  position: relative;
}

.entity-item:hover { background: var(--surface2); border-left-color: var(--border2); }
.entity-item.active { background: var(--surface2); border-left-color: var(--red); }

.entity-number {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
  margin-bottom: 3px;
  letter-spacing: 1px;
}

.entity-name {
  font-family: var(--title);
  font-size: 14px;
  color: var(--text-bright);
  margin-bottom: 4px;
}

.threat-badge {
  display: inline-block;
  font-family: var(--mono);
  font-size: 9px;
  padding: 1px 6px;
  letter-spacing: 2px;
  font-weight: bold;
}

.threat-badge.SAFE { background: var(--green-dim); color: #6ab040; border: 1px solid var(--green); }
.threat-badge.EUCLID { background: #4a3800; color: #c4920a; border: 1px solid var(--amber-dim); }
.threat-badge.KETER { background: var(--red-dim); color: #ff4444; border: 1px solid var(--red2); animation: glowRed 2s ease infinite; }
.threat-badge.THAUMIEL { background: #0a1a3a; color: #4488cc; border: 1px solid #224466; }
.threat-badge.NEUTRALIZED { background: #1a1a1a; color: #666; border: 1px solid #333; text-decoration: line-through; }

@keyframes glowRed {
  0%,100% { box-shadow: 0 0 4px rgba(204,17,17,0.4); }
  50% { box-shadow: 0 0 10px rgba(204,17,17,0.8); }
}

.entity-delete {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--red2);
  cursor: pointer;
  font-family: var(--mono);
  font-size: 13px;
  opacity: 0;
  transition: opacity 0.15s;
  padding: 4px;
}

.entity-item:hover .entity-delete { opacity: 1; }

.sidebar-footer {
  padding: 12px 16px;
  border-top: 1px solid var(--border);
  background: var(--bg2);
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 7px 14px;
  border: 1px solid var(--border2);
  background: transparent;
  color: var(--text-dim);
  font-family: var(--mono);
  font-size: 11px;
  cursor: pointer;
  letter-spacing: 2px;
  text-transform: uppercase;
  transition: all 0.15s;
  width: 100%;
}

.btn:hover { border-color: var(--red2); color: var(--red); }
.btn-danger { border-color: var(--red2); color: var(--red); }
.btn-danger:hover { background: var(--red-dim); box-shadow: 0 0 10px rgba(204,17,17,0.3); }
.btn-amber { border-color: var(--amber-dim); color: var(--amber); }
.btn-amber:hover { background: rgba(196,146,10,0.1); }
.btn-sm { padding: 4px 8px; font-size: 10px; width: auto; }

/* MAIN CONTENT */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: var(--bg);
}

/* EMPTY STATE */
.empty-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: var(--text-dim);
  font-family: var(--mono);
  text-align: center;
  padding: 40px;
  gap: 12px;
}

.empty-state .scp-symbol {
  font-size: 80px;
  opacity: 0.08;
  filter: blur(1px);
  margin-bottom: 10px;
}

.empty-state h2 {
  font-family: var(--title);
  font-size: 20px;
  color: var(--border2);
  letter-spacing: 3px;
}

.empty-state p { font-size: 12px; letter-spacing: 1px; opacity: 0.6; max-width: 360px; line-height: 1.8; }

/* DOCUMENT VIEW */
.doc-container {
  flex: 1;
  overflow-y: auto;
  padding: 32px 40px 100px;
  max-width: 900px;
  margin: 0 auto;
  width: 100%;
}

.doc-container::-webkit-scrollbar { width: 6px; }
.doc-container::-webkit-scrollbar-track { background: var(--bg2); }
.doc-container::-webkit-scrollbar-thumb { background: var(--border); }

/* DOCUMENT HEADER */
.doc-header {
  border: 1px solid var(--border);
  margin-bottom: 0;
  position: relative;
  background: var(--surface);
}

.doc-header-top {
  display: flex;
  align-items: stretch;
  border-bottom: 1px solid var(--border);
}

.doc-header-logo {
  padding: 16px 20px;
  border-right: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg2);
}

.doc-header-info {
  padding: 12px 20px;
  flex: 1;
}

.doc-item-number {
  font-family: var(--title);
  font-size: 28px;
  color: var(--red);
  letter-spacing: 2px;
  margin-bottom: 4px;
}

.doc-name {
  font-family: var(--title);
  font-size: 22px;
  color: var(--text-bright);
  letter-spacing: 1px;
}

.doc-name-input {
  font-family: var(--title) !important;
  font-size: 22px !important;
  color: var(--text-bright) !important;
  background: transparent;
  border: none !important;
  border-bottom: 1px dashed var(--border) !important;
  outline: none;
  width: 100%;
  padding: 0 !important;
}

.doc-stamps {
  padding: 12px 16px;
  display: flex;
  gap: 12px;
  align-items: center;
  border-right: 1px solid var(--border);
  flex-direction: column;
  justify-content: center;
}

.stamp {
  font-family: var(--title);
  font-size: 11px;
  padding: 3px 8px;
  border: 2px solid;
  letter-spacing: 2px;
  transform: rotate(-6deg);
  opacity: 0.85;
  white-space: nowrap;
}

.stamp.classified { color: var(--stamp-red); border-color: var(--stamp-red); transform: rotate(3deg); }
.stamp.restricted { color: var(--amber); border-color: var(--amber-dim); transform: rotate(-4deg); }

.doc-meta-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  border-top: 1px solid var(--border);
}

.doc-meta-cell {
  padding: 8px 14px;
  border-right: 1px solid var(--border);
  font-family: var(--mono);
}

.doc-meta-cell:last-child { border-right: none; }

.doc-meta-label {
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 4px;
}

.doc-meta-value {
  font-size: 12px;
  color: var(--text-bright);
}

.doc-meta-value.editable {
  background: transparent;
  border: none;
  border-bottom: 1px dashed var(--border);
  color: var(--text-bright);
  font-family: var(--mono);
  font-size: 12px;
  outline: none;
  width: 100%;
  cursor: text;
}

.threat-select {
  background: transparent;
  border: none;
  border-bottom: 1px dashed var(--border);
  color: var(--text-bright);
  font-family: var(--mono);
  font-size: 12px;
  outline: none;
  cursor: pointer;
  width: 100%;
}

.threat-select option { background: var(--surface2); }

/* WARNING BOX */
.warning-box {
  border: 1px solid var(--border);
  border-left: 4px solid var(--red);
  background: var(--red-dim);
  padding: 10px 16px;
  font-family: var(--mono);
  font-size: 11px;
  color: #ff6666;
  letter-spacing: 1px;
  line-height: 1.7;
  margin: 16px 0;
}

/* BLOCKS */
.blocks-area {
  border: 1px solid var(--border);
  border-top: none;
  background: var(--surface);
  padding: 24px;
  min-height: 300px;
  position: relative;
}

.block {
  position: relative;
  margin-bottom: 2px;
}

.block:hover .blk-controls { opacity: 1; }

.blk-controls {
  position: absolute;
  right: -44px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 2px;
  opacity: 0;
  transition: opacity 0.15s;
}

.blk-ctrl {
  width: 32px;
  height: 24px;
  border: 1px solid var(--border);
  background: var(--bg2);
  color: var(--text-dim);
  cursor: pointer;
  font-family: var(--mono);
  font-size: 11px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.1s;
}

.blk-ctrl:hover { border-color: var(--red2); color: var(--red); background: var(--red-dim); }

/* Text blocks */
.text-block {
  outline: none;
  min-height: 24px;
  padding: 3px 0;
  color: var(--text);
  line-height: 1.9;
  font-size: 14px;
  font-family: var(--serif);
  letter-spacing: 0.3px;
  caret-color: var(--red);
}

.text-block:empty::before {
  content: attr(data-ph);
  color: var(--text-dim);
  font-style: italic;
  pointer-events: none;
}

.text-block.h1 {
  font-family: var(--title);
  font-size: 18px;
  color: var(--text-bright);
  letter-spacing: 3px;
  text-transform: uppercase;
  border-bottom: 1px solid var(--border);
  padding-bottom: 8px;
  margin: 12px 0 4px;
}

.text-block.h2 {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--red);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin: 10px 0 2px;
}

.text-block.quote {
  border-left: 3px solid var(--border2);
  padding-left: 16px;
  color: var(--text-dim);
  font-style: italic;
  background: rgba(0,0,0,0.3);
  padding: 8px 8px 8px 16px;
}

.text-block.redacted {
  color: var(--bg);
  background: var(--text-dim);
  user-select: none;
  letter-spacing: 2px;
  padding: 2px 6px;
  cursor: not-allowed;
  font-size: 12px;
}

/* Image block */
.image-block { margin: 16px 0; }

.image-block img {
  max-width: 100%;
  border: 1px solid var(--border);
  display: block;
  filter: contrast(1.05) brightness(0.9);
}

.image-block .img-caption {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
  letter-spacing: 1px;
  margin-top: 6px;
  padding: 4px 8px;
  border-left: 2px solid var(--border);
  outline: none;
}

.image-block .img-caption:empty::before { content: '[–ü–û–î–ü–ò–°–¨ –ö –ú–ê–¢–ï–†–ò–ê–õ–£ ‚Äî –í–í–ï–î–ò–¢–ï –û–ü–ò–°–ê–ù–ò–ï]'; opacity: 0.4; }

.image-block .img-size-row {
  display: flex;
  gap: 4px;
  margin-top: 6px;
}

.sz-btn {
  font-family: var(--mono);
  font-size: 10px;
  padding: 2px 8px;
  border: 1px solid var(--border);
  background: none;
  color: var(--text-dim);
  cursor: pointer;
  letter-spacing: 1px;
  transition: all 0.1s;
}

.sz-btn:hover, .sz-btn.active { border-color: var(--red2); color: var(--red); }

/* Divider */
.divider-block {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 0;
  color: var(--border2);
  font-family: var(--mono);
  font-size: 11px;
  letter-spacing: 4px;
  justify-content: center;
}

.divider-block::before,
.divider-block::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

/* WARNING BLOCK */
.warn-block {
  border: 1px solid var(--red2);
  border-left: 4px solid var(--red);
  background: var(--red-dim);
  padding: 12px 16px;
  font-family: var(--mono);
  font-size: 12px;
  color: #ff6666;
  letter-spacing: 1px;
  line-height: 1.7;
  outline: none;
  margin: 8px 0;
}

.warn-block:empty::before {
  content: attr(data-ph);
  color: rgba(255,100,100,0.4);
  pointer-events: none;
  font-style: italic;
}

/* TOOLBAR */
.toolbar {
  background: var(--bg2);
  border-top: 2px solid var(--border);
  padding: 8px 16px;
  display: flex;
  gap: 6px;
  align-items: center;
  flex-wrap: wrap;
  flex-shrink: 0;
}

.toolbar-btn {
  font-family: var(--mono);
  font-size: 10px;
  padding: 5px 10px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-dim);
  cursor: pointer;
  letter-spacing: 1px;
  text-transform: uppercase;
  transition: all 0.15s;
  white-space: nowrap;
}

.toolbar-btn:hover { border-color: var(--red2); color: var(--red); background: var(--red-dim); }
.toolbar-sep { width: 1px; height: 20px; background: var(--border); }

/* MODAL */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  z-index: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  backdrop-filter: blur(2px);
}

.overlay.open { opacity: 1; pointer-events: all; }

.modal {
  background: var(--surface);
  border: 1px solid var(--border2);
  padding: 0;
  width: 500px;
  max-width: 96vw;
  transform: scale(0.96);
  transition: transform 0.2s;
  box-shadow: 0 0 40px rgba(204,17,17,0.1), 0 0 80px rgba(0,0,0,0.8);
  position: relative;
}

.overlay.open .modal { transform: scale(1); }

.modal-header {
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.modal-title {
  font-family: var(--title);
  font-size: 14px;
  color: var(--red);
  letter-spacing: 3px;
  text-transform: uppercase;
}

.modal-close {
  background: none;
  border: none;
  color: var(--text-dim);
  cursor: pointer;
  font-family: var(--mono);
  font-size: 16px;
}

.modal-close:hover { color: var(--red); }

.modal-body { padding: 24px; }

.field-label {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 6px;
  display: block;
}

.field-row { margin-bottom: 16px; }

.field-input {
  background: var(--bg2);
  border: 1px solid var(--border);
  color: var(--text-bright);
  font-family: var(--mono);
  font-size: 14px;
  padding: 8px 12px;
  outline: none;
  width: 100%;
  letter-spacing: 1px;
  transition: border-color 0.15s;
}

.field-input:focus { border-color: var(--red2); box-shadow: 0 0 8px rgba(204,17,17,0.2); }
.field-input::placeholder { color: var(--text-dim); font-style: italic; }

.field-select {
  background: var(--bg2);
  border: 1px solid var(--border);
  color: var(--text-bright);
  font-family: var(--mono);
  font-size: 12px;
  padding: 8px 12px;
  outline: none;
  width: 100%;
  cursor: pointer;
}

.field-select option { background: var(--surface2); }
.field-select:focus { border-color: var(--red2); }

.modal-footer {
  padding: 12px 20px;
  border-top: 1px solid var(--border);
  background: var(--bg2);
  display: flex;
  gap: 10px;
  justify-content: flex-end;
}

.modal-btn {
  font-family: var(--mono);
  font-size: 11px;
  padding: 7px 18px;
  border: 1px solid;
  cursor: pointer;
  letter-spacing: 2px;
  text-transform: uppercase;
  background: transparent;
  transition: all 0.15s;
}

.modal-btn.cancel { border-color: var(--border2); color: var(--text-dim); }
.modal-btn.cancel:hover { border-color: var(--border2); color: var(--text); }
.modal-btn.confirm { border-color: var(--red2); color: var(--red); }
.modal-btn.confirm:hover { background: var(--red-dim); box-shadow: 0 0 12px rgba(204,17,17,0.3); }

/* PASSWORD MODAL SPECIAL */
.pass-display {
  font-family: var(--mono);
  font-size: 24px;
  letter-spacing: 8px;
  color: var(--green);
  text-align: center;
  padding: 16px;
  background: #000;
  border: 1px solid var(--green-dim);
  margin-bottom: 4px;
  min-height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.pass-error {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--red);
  letter-spacing: 2px;
  text-align: center;
  min-height: 18px;
  margin-top: 6px;
  animation: passErr 0.3s ease;
}

@keyframes passErr { 0%,100%{transform:none} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }

/* TABS */
.tab-row { display: flex; gap: 4px; margin-bottom: 16px; }

.tab-btn {
  font-family: var(--mono);
  font-size: 10px;
  padding: 6px 14px;
  border: 1px solid var(--border);
  background: none;
  color: var(--text-dim);
  cursor: pointer;
  letter-spacing: 2px;
  text-transform: uppercase;
  transition: all 0.15s;
}

.tab-btn.active { border-color: var(--red2); color: var(--red); background: var(--red-dim); }

.tab-panel { display: none; }
.tab-panel.active { display: block; }

/* DROP ZONE */
.dropzone {
  border: 2px dashed var(--border);
  padding: 28px;
  text-align: center;
  color: var(--text-dim);
  font-family: var(--mono);
  font-size: 11px;
  letter-spacing: 2px;
  cursor: pointer;
  transition: all 0.2s;
  background: var(--bg2);
}

.dropzone:hover, .dropzone.over { border-color: var(--red2); color: var(--red); background: var(--red-dim); }
.dropzone input { display: none; }

/* NOTIFICATION */
.toast {
  position: fixed;
  bottom: 80px;
  right: 20px;
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-left: 4px solid var(--red);
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text);
  padding: 10px 16px;
  letter-spacing: 2px;
  text-transform: uppercase;
  z-index: 9990;
  transform: translateX(120%);
  transition: transform 0.25s;
  max-width: 320px;
}

.toast.show { transform: none; }

/* Read-only overlay */
.readonly-banner {
  position: sticky;
  top: 0;
  z-index: 50;
  background: var(--red-dim);
  border: 1px solid var(--red2);
  border-top: none;
  padding: 6px 20px;
  font-family: var(--mono);
  font-size: 10px;
  color: #ff6666;
  letter-spacing: 3px;
  text-transform: uppercase;
  text-align: center;
}

/* animations */
@keyframes fadeSlide {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: none; }
}

.doc-view { animation: fadeSlide 0.25s ease; }
.entity-item { animation: fadeSlide 0.15s ease; }

/* Glitch on entity name hover */
.entity-name:hover {
  animation: glitch 0.3s linear;
}

@keyframes glitch {
  0%,100% { text-shadow: none; }
  20% { text-shadow: -2px 0 var(--red); clip-path: inset(20% 0 60% 0); }
  40% { text-shadow: 2px 0 var(--amber); }
  60% { text-shadow: -1px 0 var(--red); }
  80% { text-shadow: 1px 0 rgba(100,200,255,0.5); }
}

/* Doc section separator line */
.section-divider {
  height: 1px;
  background: var(--border);
  margin: 20px 0;
}

/* Append id marker */
.doc-id-corner {
  position: absolute;
  top: 8px;
  right: 12px;
  font-family: var(--mono);
  font-size: 9px;
  color: var(--border2);
  letter-spacing: 2px;
}
</style>
</head>
<body>

<!-- BOOT SCREEN -->
<div id="bootScreen">
  <div class="boot-logo">‚ò£</div>
  <div class="boot-line">SCP FOUNDATION ‚Äî SECURE CONTAIN PROTECT</div>
  <div class="boot-line" style="margin:8px 0; color:#333;">‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</div>
  <div class="boot-line ok">[OK] –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–û–¢–û–ö–û–õ–û–í –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò</div>
  <div class="boot-line ok">[OK] –ü–†–û–í–ï–†–ö–ê –¶–ï–õ–û–°–¢–ù–û–°–¢–ò –ë–ê–ó–´ –î–ê–ù–ù–´–•</div>
  <div class="boot-line warn">[!!] –û–ë–ù–ê–†–£–ñ–ï–ù–´ –ê–ù–û–ú–ê–õ–¨–ù–´–ï –û–ë–™–ï–ö–¢–´: –°–í–ï–†–ö–ê...</div>
  <div class="boot-line ok">[OK] –£–†–û–í–ï–ù–¨ –î–û–°–¢–£–ü–ê: –¢–û–õ–¨–ö–û –ß–¢–ï–ù–ò–ï</div>
  <div class="boot-line ok">[OK] –°–û–ï–î–ò–ù–ï–ù–ò–ï –° –°–ï–†–í–ï–†–û–ú –û5</div>
  <div class="boot-line ok ">[OK] –¢–´ –°–¢–ê–õ –®–õ–Æ–•–û–ô –ï–ë–ê–ù–û–ô</div>
  <div class="boot-line ok ">[OK] –ú–ò–•–ê–õ–´–ß –¢–ï–ë–ï –ó–ê–õ–£–ü–£ –í–´–ë–¨–ï–¢</div>
  <div class="boot-line" style="margin-top:16px; color:#444; font-size:11px;">–î–û–°–¢–£–ü –†–ê–ó–†–ï–®–Å–ù <span class="blink">‚ñà</span></div>
</div>

<!-- HEADER -->
<header>
  <div class="scp-logo">
    <svg width="32" height="32" viewBox="0 0 100 100" fill="none">
      <circle cx="50" cy="50" r="45" stroke="#cc1111" stroke-width="3"/>
      <circle cx="50" cy="50" r="20" stroke="#cc1111" stroke-width="2"/>
      <path d="M50 5 A45 45 0 0 1 89.1 72.5 L64 57.5 A20 20 0 0 0 50 30 Z" fill="#cc1111" opacity="0.8"/>
      <path d="M89.1 72.5 A45 45 0 0 1 10.9 72.5 L36 57.5 A20 20 0 0 0 64 57.5 Z" fill="#cc1111" opacity="0.8"/>
      <path d="M10.9 72.5 A45 45 0 0 1 50 5 L50 30 A20 20 0 0 0 36 57.5 Z" fill="#cc1111" opacity="0.8"/>
    </svg>
    SCP FOUNDATION
  </div>
  <div class="header-mid">
    –ë–ê–ó–ê –î–ê–ù–ù–´–• –ê–ù–û–ú–ê–õ–¨–ù–´–• –û–ë–™–ï–ö–¢–û–í<br>
    <span style="color:var(--border2);">CLEARANCE REQUIRED /// UNAUTHORIZED ACCESS PROHIBITED</span>
  </div>
  <div class="header-right">
    <div class="access-badge read-only" id="accessBadge">‚óè –¢–û–õ–¨–ö–û –ß–¢–ï–ù–ò–ï</div>
    <button class="btn btn-sm" style="width:auto;" onclick="openAuthModal()" id="authBtn">‚¨° –î–û–°–¢–£–ü –ü–ï–†–°–û–ù–ê–õ–ê</button>
    <button class="btn btn-sm btn-danger" style="width:auto;display:none;" onclick="logout()" id="logoutBtn">‚¨° –í–´–•–û–î</button>
  </div>
</header>

<!-- LAYOUT -->
<div class="app-layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-label">–û–ë–™–ï–ö–¢–´ –ë–ê–ó–´</div>
      <input type="text" class="sidebar-search" placeholder="–ü–û–ò–°–ö –û–ë–™–ï–ö–¢–ê..." oninput="filterEntities(this.value)">
    </div>
    <div class="entity-list" id="entityList"></div>
    <div class="sidebar-footer">
      <button class="btn btn-danger" id="addEntityBtn" onclick="openNewEntityModal()" style="display:none;">
        ‚äï –°–û–ó–î–ê–¢–¨ –û–ë–™–ï–ö–¢
      </button>
      <div id="readonlyNote" style="font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:1px;text-align:center;line-height:1.6;">
        –£–†–û–í–ï–ù–¨ –î–û–°–¢–£–ü–ê: –¢–û–õ–¨–ö–û –ß–¢–ï–ù–ò–ï<br>–î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ‚Äî –ò–î–ò–¢–ï –ù–ê–•–£–ô
      </div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <div class="main-content" id="mainContent">
    <div class="empty-state" id="emptyState">
      <div class="scp-symbol">‚ò£</div>
      <h2>–û–ë–™–ï–ö–¢ –ù–ï –í–´–ë–†–ê–ù</h2>
      <p>–í–´–ë–ï–†–ò–¢–ï –û–ë–™–ï–ö–¢ –ò–ó –°–ü–ò–°–ö–ê –°–õ–ï–í–ê –î–õ–Ø –ü–†–û–°–ú–û–¢–†–ê –î–û–°–¨–ï<br><br>
      –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ù–û–í–´–• –û–ë–™–ï–ö–¢–û–í –¢–†–ï–ë–£–ï–¢–°–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –£–†–û–í–ù–Ø –û5</p>
    </div>
  </div>

</div>

<!-- ADMIN TOOLBAR (hidden) -->
<div id="adminToolbar" style="display:none;">
  <div class="toolbar">
    <button class="toolbar-btn" onclick="addBlock('text')">¬∂ –ê–±–∑–∞—Ü</button>
    <button class="toolbar-btn" onclick="addBlock('h1')">H1 –ó–∞–≥–æ–ª–æ–≤–æ–∫</button>
    <button class="toolbar-btn" onclick="addBlock('h2')">H2 –†–∞–∑–¥–µ–ª</button>
    <button class="toolbar-btn" onclick="addBlock('quote')">‚ùù –¶–∏—Ç–∞—Ç–∞</button>
    <button class="toolbar-btn" onclick="addBlock('warning')">‚ö† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</button>
    <div class="toolbar-sep"></div>
    <button class="toolbar-btn" onclick="openImageModal()">‚¨õ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/GIF</button>
    <button class="toolbar-btn" onclick="addBlock('divider')">‚îÄ‚îÄ –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å</button>
    <div class="toolbar-sep"></div>
    <button class="toolbar-btn" style="margin-left:auto;" onclick="saveAll()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="overlay" id="authOverlay">
  <div class="modal" style="width:380px;">
    <div class="modal-header">
      <div class="modal-title">‚¨° –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ü–ï–†–°–û–ù–ê–õ–ê</div>
      <button class="modal-close" onclick="closeModal('authOverlay')">‚úï</button>
    </div>
    <div class="modal-body">
      <div style="font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:2px;text-align:center;margin-bottom:20px;line-height:1.8;">
        –í–í–ï–î–ò–¢–ï –ö–û–î –î–û–°–¢–£–ü–ê<br>
        <span style="color:var(--red-dim);">–ù–ï–°–ê–ù–ö–¶–ò–û–ù–ò–†–û–í–ê–ù–ù–´–ô –î–û–°–¢–£–ü –§–ò–ö–°–ò–†–£–ï–¢–°–Ø</span>
      </div>
      <div class="pass-display" id="passDisplay"><span class="blink" style="color:var(--green-dim);">‚ñà</span></div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px;margin-top:12px;" id="keypad">
        <!-- generated by JS -->
      </div>
      <div class="pass-error" id="passError"></div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel" onclick="clearPass()">–°–ë–†–û–°</button>
      <button class="modal-btn confirm" onclick="attemptAuth()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
    </div>
  </div>
</div>

<!-- NEW ENTITY MODAL -->
<div class="overlay" id="newEntityOverlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">‚äï –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ù–û–í–û–ì–û –û–ë–™–ï–ö–¢–ê</div>
      <button class="modal-close" onclick="closeModal('newEntityOverlay')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="field-row">
        <label class="field-label">–û–ë–û–ó–ù–ê–ß–ï–ù–ò–ï –û–ë–™–ï–ö–¢–ê</label>
        <input type="text" class="field-input" id="newEntityName" placeholder="–ò–ú–Ø / –ù–ê–ó–í–ê–ù–ò–ï...">
      </div>
      <div class="field-row">
        <label class="field-label">–ö–õ–ê–°–° –£–ì–†–û–ó–´</label>
        <select class="field-select" id="newEntityThreat">
          <option value="SAFE">SAFE ‚Äî –ë–ï–ó–û–ü–ê–°–ù–´–ô</option>
          <option value="EUCLID" selected>EUCLID ‚Äî –ï–í–ö–õ–ò–î</option>
          <option value="KETER">KETER ‚Äî –ö–ï–¢–ï–† ‚ö†</option>
          <option value="THAUMIEL">THAUMIEL ‚Äî –¢–ê–£–ú–ò–≠–õ–¨</option>
          <option value="NEUTRALIZED">NEUTRALIZED ‚Äî –ù–ï–ô–¢–†–ê–õ–ò–ó–û–í–ê–ù</option>
        </select>
      </div>
      <div class="field-row">
        <label class="field-label">–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–´–ô –ò–°–°–õ–ï–î–û–í–ê–¢–ï–õ–¨</label>
        <input type="text" class="field-input" id="newEntityResearcher" placeholder="–î-—Ä ...">
      </div>
      <div class="field-row">
        <label class="field-label">–ú–ï–°–¢–û –°–û–î–ï–†–ñ–ê–ù–ò–Ø</label>
        <input type="text" class="field-input" id="newEntityLocation" placeholder="–ó–û–ù–ê-19, –°–ï–ö–¢–û–†-–ë...">
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel" onclick="closeModal('newEntityOverlay')">–û–¢–ú–ï–ù–ê</button>
      <button class="modal-btn confirm" onclick="createEntity()">–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨</button>
    </div>
  </div>
</div>

<!-- IMAGE MODAL -->
<div class="overlay" id="imageOverlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">‚¨õ –í–õ–û–ñ–ò–¢–¨ –ú–ê–¢–ï–†–ò–ê–õ</div>
      <button class="modal-close" onclick="closeModal('imageOverlay')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="tab-row">
        <button class="tab-btn active" onclick="switchImgTab('url')">–ü–û –°–°–´–õ–ö–ï</button>
        <button class="tab-btn" onclick="switchImgTab('upload')">–ó–ê–ì–†–£–ó–ò–¢–¨</button>
      </div>
      <div class="tab-panel active" id="imgtab-url">
        <div class="field-row">
          <label class="field-label">URL –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø / GIF</label>
          <input type="url" class="field-input" id="imgUrl" placeholder="https://...">
        </div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:1px;">
          –ü–û–î–î–ï–†–ñ–ò–í–ê–Æ–¢–°–Ø: .JPG .PNG .GIF .WEBP ‚Äî GIPHY / TENOR
        </div>
      </div>
      <div class="tab-panel" id="imgtab-upload">
        <div class="dropzone" id="dropZone" onclick="document.getElementById('fileInput').click()">
          <input type="file" id="fileInput" accept="image/*,.gif" onchange="handleFile(event)">
          <div style="font-size:24px;margin-bottom:8px;">‚¨õ</div>
          –ù–ê–ñ–ú–ò–¢–ï –ò–õ–ò –ü–ï–†–ï–¢–ê–©–ò–¢–ï –§–ê–ô–õ
        </div>
      </div>
      <div class="field-row" style="margin-top:16px;">
        <label class="field-label">–í–´–†–ê–í–ù–ò–í–ê–ù–ò–ï</label>
        <select class="field-select" id="imgAlign">
          <option value="center" selected>–ü–û –¶–ï–ù–¢–†–£</option>
          <option value="left">–ü–û –õ–ï–í–û–ú–£ –ö–†–ê–Æ</option>
          <option value="right">–ü–û –ü–†–ê–í–û–ú–£ –ö–†–ê–Æ</option>
          <option value="float-left">–û–ë–¢–ï–ö–ê–ù–ò–ï –°–õ–ï–í–ê</option>
          <option value="float-right">–û–ë–¢–ï–ö–ê–ù–ò–ï –°–ü–†–ê–í–ê</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel" onclick="closeModal('imageOverlay')">–û–¢–ú–ï–ù–ê</button>
      <button class="modal-btn confirm" onclick="insertImage()">–í–õ–û–ñ–ò–¢–¨</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ADMIN_PASS = 'root';
let isAdmin = false;
let entities = JSON.parse(localStorage.getItem('scp_entities') || '[]');
let activeId = null;
let passBuffer = '';
let pendingImgData = null;
let scpCounter = 7000 + Math.floor(Math.random() * 2000);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('load', () => {
  buildKeypad();
  renderEntityList();
  if (entities.length > 0) selectEntity(entities[0].id);
  // remove boot after 3s
  setTimeout(() => {
    const b = document.getElementById('bootScreen');
    b.style.display = 'none';
  }, 3200);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildKeypad() {
  const kp = document.getElementById('keypad');
  const keys = ['7','8','9','4','5','6','1','2','3','‚å´','0','‚Üµ'];
  kp.innerHTML = '';
  keys.forEach(k => {
    const btn = document.createElement('button');
    btn.textContent = k;
    btn.className = 'modal-btn cancel';
    btn.style.fontFamily = 'var(--mono)';
    btn.style.fontSize = '18px';
    btn.style.padding = '12px';
    btn.style.letterSpacing = '0';
    btn.onclick = () => keypressHandler(k);
    kp.appendChild(btn);
  });
}

function keypressHandler(k) {
  if (k === '‚å´') { passBuffer = passBuffer.slice(0,-1); }
  else if (k === '‚Üµ') { attemptAuth(); return; }
  else if (passBuffer.length < 12) { passBuffer += k; }
  document.getElementById('passDisplay').innerHTML =
    passBuffer ? '‚óè'.repeat(passBuffer.length) : '<span class="blink" style="color:var(--green-dim)">‚ñà</span>';
  document.getElementById('passError').textContent = '';
}

function clearPass() {
  passBuffer = '';
  document.getElementById('passDisplay').innerHTML = '<span class="blink" style="color:var(--green-dim)">‚ñà</span>';
  document.getElementById('passError').textContent = '';
}

function openAuthModal() {
  clearPass();
  openOverlay('authOverlay');
}

function attemptAuth() {
  // also accept text input typed with keyboard
  if (passBuffer === ADMIN_PASS || document.getElementById('passDisplay').textContent.replace(/‚óè/g,'') === ADMIN_PASS) {
    // wrong - passBuffer is '‚óè' based, we store actual chars
  }
  if (passBuffer !== ADMIN_PASS) {
    document.getElementById('passError').textContent = '‚ö† –ö–û–î –î–û–°–¢–£–ü–ê –ù–ï–í–ï–†–ï–ù ‚Äî –ò–ù–¶–ò–î–ï–ù–¢ –ó–ê–§–ò–ö–°–ò–†–û–í–ê–ù';
    clearPass();
    return;
  }
  isAdmin = true;
  closeModal('authOverlay');
  document.getElementById('accessBadge').textContent = '‚óè –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† –û5';
  document.getElementById('accessBadge').className = 'access-badge admin';
  document.getElementById('authBtn').style.display = 'none';
  document.getElementById('logoutBtn').style.display = 'inline-flex';
  document.getElementById('addEntityBtn').style.display = 'flex';
  document.getElementById('readonlyNote').style.display = 'none';
  document.getElementById('adminToolbar').style.display = 'block';
  toast('–î–û–°–¢–£–ü –†–ê–ó–†–ï–®–Å–ù // –£–†–û–í–ï–ù–¨ –û5');
  if (activeId) renderDoc();
}

function logout() {
  isAdmin = false;
  document.getElementById('accessBadge').textContent = '‚óè –¢–û–õ–¨–ö–û –ß–¢–ï–ù–ò–ï';
  document.getElementById('accessBadge').className = 'access-badge read-only';
  document.getElementById('authBtn').style.display = 'inline-flex';
  document.getElementById('logoutBtn').style.display = 'none';
  document.getElementById('addEntityBtn').style.display = 'none';
  document.getElementById('readonlyNote').style.display = 'block';
  document.getElementById('adminToolbar').style.display = 'none';
  toast('–°–ï–°–°–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê');
  if (activeId) renderDoc();
}

// Allow keyboard typing in pass modal
document.addEventListener('keydown', (e) => {
  const overlay = document.getElementById('authOverlay');
  if (!overlay.classList.contains('open')) return;
  if (e.key >= '0' && e.key <= '9') keypressHandler(e.key);
  else if (e.key === 'Backspace') keypressHandler('‚å´');
  else if (e.key === 'Enter') keypressHandler('‚Üµ');
  // also allow letter input for "root"
  else if (/^[a-zA-Z]$/.test(e.key)) {
    if (passBuffer.length < 12) passBuffer += e.key;
    document.getElementById('passDisplay').innerHTML = '‚óè'.repeat(passBuffer.length);
    document.getElementById('passError').textContent = '';
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ENTITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderEntityList(filter = '') {
  const list = document.getElementById('entityList');
  list.innerHTML = '';
  const filtered = filter
    ? entities.filter(e => e.name.toLowerCase().includes(filter.toLowerCase()) || e.number.includes(filter))
    : entities;

  filtered.forEach(e => {
    const item = document.createElement('div');
    item.className = 'entity-item' + (e.id === activeId ? ' active' : '');
    item.onclick = () => selectEntity(e.id);
    item.innerHTML = `
      <div class="entity-number">SCP-${e.number}</div>
      <div class="entity-name">${esc(e.name)}</div>
      <span class="threat-badge ${e.threat}">${e.threat}</span>
      ${isAdmin ? `<button class="entity-delete" onclick="deleteEntity(event,'${e.id}')">‚úï</button>` : ''}
    `;
    list.appendChild(item);
  });
}

function filterEntities(q) { renderEntityList(q); }

function selectEntity(id) {
  if (activeId && isAdmin) saveCurrentEntity();
  activeId = id;
  renderEntityList();
  renderDoc();
}

function openNewEntityModal() {
  if (!isAdmin) { toast('–î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–Å–ù'); return; }
  document.getElementById('newEntityName').value = '';
  document.getElementById('newEntityResearcher').value = '';
  document.getElementById('newEntityLocation').value = '';
  openOverlay('newEntityOverlay');
}

function createEntity() {
  const name = document.getElementById('newEntityName').value.trim();
  if (!name) { toast('–í–í–ï–î–ò–¢–ï –û–ë–û–ó–ù–ê–ß–ï–ù–ò–ï –û–ë–™–ï–ö–¢–ê'); return; }
  scpCounter++;
  const entity = {
    id: 'e' + Date.now(),
    number: String(scpCounter),
    name,
    threat: document.getElementById('newEntityThreat').value,
    researcher: document.getElementById('newEntityResearcher').value.trim() || '–ó–ê–°–ï–ö–†–ï–ß–ï–ù–û',
    location: document.getElementById('newEntityLocation').value.trim() || '–ó–ê–°–ï–ö–†–ï–ß–ï–ù–û',
    blocks: []
  };
  entities.push(entity);
  closeModal('newEntityOverlay');
  saveAll();
  renderEntityList();
  selectEntity(entity.id);
}

function deleteEntity(e, id) {
  e.stopPropagation();
  if (!confirm('–£–î–ê–õ–ò–¢–¨ –û–ë–™–ï–ö–¢ –ò–ó –ë–ê–ó–´? –≠–¢–û –î–ï–ô–°–¢–í–ò–ï –ù–ï–û–ë–†–ê–¢–ò–ú–û.')) return;
  entities = entities.filter(x => x.id !== id);
  if (activeId === id) {
    activeId = null;
    document.getElementById('mainContent').innerHTML = `
      <div class="empty-state" id="emptyState">
        <div class="scp-symbol">‚ò£</div>
        <h2>–û–ë–™–ï–ö–¢ –£–î–ê–õ–Å–ù</h2>
        <p>–ó–ê–ü–ò–°–¨ –£–ù–ò–ß–¢–û–ñ–ï–ù–ê –ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–•</p>
      </div>`;
  }
  saveAll();
  renderEntityList();
}

function getEntity(id) { return entities.find(e => e.id === id); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DOCUMENT RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDoc() {
  const entity = getEntity(activeId);
  if (!entity) return;

  const main = document.getElementById('mainContent');
  main.innerHTML = '';

  if (!isAdmin) {
    const banner = document.createElement('div');
    banner.className = 'readonly-banner';
    banner.textContent = '‚ö† –†–ï–ñ–ò–ú –¢–û–õ–¨–ö–û –î–õ–Ø –ß–¢–ï–ù–ò–Ø // –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–ü–†–ï–©–ï–ù–û // –ù–ï–°–ê–ù–ö–¶–ò–û–ù–ò–†–û–í–ê–ù–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• –Ø–í–õ–Ø–ï–¢–°–Ø –ù–ê–†–£–®–ï–ù–ò–ï–ú –ü–†–û–¢–û–ö–û–õ–ê';
    main.appendChild(banner);
  }

  const docView = document.createElement('div');
  docView.className = 'doc-view';
  docView.style.cssText = 'flex:1;overflow-y:auto;padding:28px 32px 80px;';
  docView.innerHTML = buildDocHeader(entity);

  const blocksArea = document.createElement('div');
  blocksArea.className = 'blocks-area';
  blocksArea.id = 'blocksArea';
  docView.appendChild(blocksArea);

  main.appendChild(docView);
  docView.style.display = 'flex';
  docView.style.flexDirection = 'column';

  // Scrollbar
  docView.style.cssText += ';overflow-y:auto;';
  docView.addEventListener('scroll', () => {});

  renderBlocks(entity);

  if (!entity.blocks || entity.blocks.length === 0) {
    if (isAdmin) {
      addBlock('h1');
      addBlock('text');
    }
  }
}

function buildDocHeader(entity) {
  const isEdit = isAdmin;
  return `
  <div class="doc-header" style="margin-bottom:16px;">
    <div class="doc-id-corner">–î–û–ö–£–ú–ï–ù–¢ #${entity.number}-${Date.now().toString(36).toUpperCase().slice(-4)}</div>
    <div class="doc-header-top">
      <div class="doc-header-logo">
        <svg width="52" height="52" viewBox="0 0 100 100" fill="none">
          <circle cx="50" cy="50" r="45" stroke="#cc1111" stroke-width="3"/>
          <circle cx="50" cy="50" r="20" stroke="#cc1111" stroke-width="2"/>
          <path d="M50 5 A45 45 0 0 1 89.1 72.5 L64 57.5 A20 20 0 0 0 50 30 Z" fill="#cc1111" opacity="0.8"/>
          <path d="M89.1 72.5 A45 45 0 0 1 10.9 72.5 L36 57.5 A20 20 0 0 0 64 57.5 Z" fill="#cc1111" opacity="0.8"/>
          <path d="M10.9 72.5 A45 45 0 0 1 50 5 L50 30 A20 20 0 0 0 36 57.5 Z" fill="#cc1111" opacity="0.8"/>
        </svg>
      </div>
      <div class="doc-header-info">
        <div class="doc-item-number">–û–ë–™–ï–ö–¢ ‚Ññ: SCP-${entity.number}</div>
        ${isEdit
          ? `<input class="doc-name-input" type="text" value="${esc(entity.name)}" id="docNameInput" oninput="updateEntityMeta('name',this.value)">`
          : `<div class="doc-name">${esc(entity.name)}</div>`}
      </div>
      <div class="doc-stamps">
        <div class="stamp classified">–ó–ê–°–ï–ö–†–ï–ß–ï–ù–û</div>
        <div class="stamp restricted">–û–ì–†–ê–ù–ò–ß–ï–ù–ù–´–ô –î–û–°–¢–£–ü</div>
      </div>
    </div>
    <div class="doc-meta-row">
      <div class="doc-meta-cell">
        <div class="doc-meta-label">–ö–õ–ê–°–° –£–ì–†–û–ó–´</div>
        <div class="doc-meta-value">
          ${isEdit
            ? `<select class="threat-select" onchange="updateEntityMeta('threat',this.value)">
                ${['SAFE','EUCLID','KETER','THAUMIEL','NEUTRALIZED'].map(t=>`<option value="${t}" ${entity.threat===t?'selected':''}>${t}</option>`).join('')}
               </select>`
            : `<span class="threat-badge ${entity.threat}">${entity.threat}</span>`}
        </div>
      </div>
      <div class="doc-meta-cell">
        <div class="doc-meta-label">–ò–°–°–õ–ï–î–û–í–ê–¢–ï–õ–¨</div>
        <div class="doc-meta-value">
          ${isEdit
            ? `<input class="doc-meta-value editable" type="text" value="${esc(entity.researcher||'')}" oninput="updateEntityMeta('researcher',this.value)">`
            : esc(entity.researcher || '–ó–ê–°–ï–ö–†–ï–ß–ï–ù–û')}
        </div>
      </div>
      <div class="doc-meta-cell">
        <div class="doc-meta-label">–ú–ï–°–¢–û –°–û–î–ï–†–ñ–ê–ù–ò–Ø</div>
        <div class="doc-meta-value">
          ${isEdit
            ? `<input class="doc-meta-value editable" type="text" value="${esc(entity.location||'')}" oninput="updateEntityMeta('location',this.value)">`
            : esc(entity.location || '–ó–ê–°–ï–ö–†–ï–ß–ï–ù–û')}
        </div>
      </div>
      <div class="doc-meta-cell">
        <div class="doc-meta-label">–°–¢–ê–¢–£–°</div>
        <div class="doc-meta-value" style="color:${entity.threat==='NEUTRALIZED'?'#666':entity.threat==='KETER'?'var(--red)':'var(--green)'};">
          ${entity.threat === 'NEUTRALIZED' ? '–ù–ï–ô–¢–†–ê–õ–ò–ó–û–í–ê–ù' : entity.threat === 'KETER' ? '‚ö† –ê–ö–¢–ò–í–ï–ù' : '–ü–û–î –ö–û–ù–¢–†–û–õ–ï–ú'}
        </div>
      </div>
    </div>
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BLOCKS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderBlocks(entity) {
  const area = document.getElementById('blocksArea');
  if (!area) return;
  area.innerHTML = '';
  (entity.blocks || []).forEach((b, i) => area.appendChild(buildBlockEl(b, i)));
}

function buildBlockEl(block, idx) {
  const wrap = document.createElement('div');
  wrap.className = 'block';

  if (isAdmin) {
    const ctrl = document.createElement('div');
    ctrl.className = 'blk-controls';
    ctrl.innerHTML = `
      <button class="blk-ctrl" onclick="moveBlock(${idx},-1)" title="–í–≤–µ—Ä—Ö">‚Üë</button>
      <button class="blk-ctrl" onclick="moveBlock(${idx},1)" title="–í–Ω–∏–∑">‚Üì</button>
      <button class="blk-ctrl" onclick="removeBlock(${idx})" title="–£–¥–∞–ª–∏—Ç—å" style="color:var(--red)">‚úï</button>
    `;
    wrap.appendChild(ctrl);
  }

  if (block.type === 'image') {
    const imgWrap = document.createElement('div');
    imgWrap.className = 'image-block';
    const sizeW = block.size === 'small' ? '280px' : block.size === 'large' ? '100%' : '520px';
    const alignStyle =
      block.align === 'center' ? `margin:0 auto; max-width:${sizeW};` :
      block.align === 'right' ? `margin-left:auto; max-width:${sizeW};` :
      block.align === 'float-left' ? `float:left; margin:0 16px 8px 0; max-width:${sizeW};` :
      block.align === 'float-right' ? `float:right; margin:0 0 8px 16px; max-width:${sizeW};` :
      `max-width:${sizeW};`;
    imgWrap.innerHTML = `
      <div style="${alignStyle}">
        <img src="${esc(block.src)}" alt="" style="width:100%;" onerror="this.style.opacity=0.3">
        ${isAdmin ? `<div class="img-size-row">
          <button class="sz-btn ${block.size==='small'?'active':''}" onclick="setImgSize(${idx},'small')">–ú–ê–õ–´–ô</button>
          <button class="sz-btn ${!block.size||block.size==='medium'?'active':''}" onclick="setImgSize(${idx},'medium')">–°–†–ï–î–ù–ò–ô</button>
          <button class="sz-btn ${block.size==='large'?'active':''}" onclick="setImgSize(${idx},'large')">–ü–û–õ–ù–´–ô</button>
        </div>` : ''}
        <div class="img-caption" contenteditable="${isAdmin}" data-idx="${idx}" onblur="saveCaption(${idx},this)">${esc(block.caption||'')}</div>
      </div>
    `;
    wrap.appendChild(imgWrap);
  } else if (block.type === 'divider') {
    wrap.innerHTML += `<div class="divider-block">// –¢–û–ú I // –¢–û–ú II //</div>`;
  } else if (block.type === 'warning') {
    const d = document.createElement('div');
    d.className = 'warn-block';
    d.contentEditable = isAdmin ? 'true' : 'false';
    d.setAttribute('data-ph', '‚ö† –í–ù–ò–ú–ê–ù–ò–ï: –í–í–ï–î–ò–¢–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï...');
    d.innerHTML = block.content || '';
    if (isAdmin) d.addEventListener('input', () => { getEntity(activeId).blocks[idx].content = d.innerHTML; });
    wrap.appendChild(d);
  } else {
    const d = document.createElement('div');
    d.className = `text-block ${block.type === 'h1' ? 'h1' : block.type === 'h2' ? 'h2' : block.type === 'quote' ? 'quote' : ''}`;
    d.contentEditable = isAdmin ? 'true' : 'false';
    d.setAttribute('data-ph',
      block.type === 'h1' ? '–†–ê–ó–î–ï–õ: –ü–†–û–¶–ï–î–£–†–´ –°–û–î–ï–†–ñ–ê–ù–ò–Ø...' :
      block.type === 'h2' ? '–ü–û–î–†–ê–ó–î–ï–õ...' :
      block.type === 'quote' ? '–ü–û–ö–ê–ó–ê–ù–ò–Ø –°–í–ò–î–ï–¢–ï–õ–Ø / –ó–ê–ü–ò–°–¨ –ñ–£–†–ù–ê–õ–ê...' :
      '–û–ü–ò–°–ê–ù–ò–ï / –ò–°–¢–û–†–ò–Ø –û–ë–™–ï–ö–¢–ê...'
    );
    d.innerHTML = block.content || '';
    if (isAdmin) {
      d.addEventListener('input', () => { getEntity(activeId).blocks[idx].content = d.innerHTML; });
      d.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey && block.type !== 'text') { e.preventDefault(); addBlock('text'); }
      });
    }
    wrap.appendChild(d);
  }

  return wrap;
}

function addBlock(type) {
  const entity = getEntity(activeId);
  if (!entity || !isAdmin) return;
  if (!entity.blocks) entity.blocks = [];
  entity.blocks.push({ type, content: '', src: '', caption: '', align: 'center', size: 'medium' });
  renderBlocks(entity);
  setTimeout(() => {
    const tbs = document.querySelectorAll('.text-block, .warn-block');
    if (tbs.length) tbs[tbs.length-1].focus();
  }, 50);
}

function removeBlock(idx) {
  const entity = getEntity(activeId);
  if (!entity) return;
  entity.blocks.splice(idx, 1);
  renderBlocks(entity);
}

function moveBlock(idx, dir) {
  const entity = getEntity(activeId);
  if (!entity) return;
  const ni = idx + dir;
  if (ni < 0 || ni >= entity.blocks.length) return;
  [entity.blocks[idx], entity.blocks[ni]] = [entity.blocks[ni], entity.blocks[idx]];
  renderBlocks(entity);
}

function setImgSize(idx, size) {
  const entity = getEntity(activeId);
  if (!entity || !entity.blocks[idx]) return;
  entity.blocks[idx].size = size;
  renderBlocks(entity);
}

function saveCaption(idx, el) {
  const entity = getEntity(activeId);
  if (!entity || !entity.blocks[idx]) return;
  entity.blocks[idx].caption = el.innerText;
}

function updateEntityMeta(field, value) {
  const entity = getEntity(activeId);
  if (!entity) return;
  entity[field] = value;
  renderEntityList();
}

function saveCurrentEntity() {
  const entity = getEntity(activeId);
  if (!entity) return;
  const nameEl = document.getElementById('docNameInput');
  if (nameEl) entity.name = nameEl.value;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// IMAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openImageModal() {
  pendingImgData = null;
  document.getElementById('imgUrl').value = '';
  document.getElementById('dropZone').innerHTML = `<input type="file" id="fileInput" accept="image/*,.gif" onchange="handleFile(event)"><div style="font-size:24px;margin-bottom:8px;">‚¨õ</div>–ù–ê–ñ–ú–ò–¢–ï –ò–õ–ò –ü–ï–†–ï–¢–ê–©–ò–¢–ï –§–ê–ô–õ`;
  document.getElementById('fileInput').onchange = handleFile;
  switchImgTab('url');
  openOverlay('imageOverlay');

  const dz = document.getElementById('dropZone');
  dz.ondragover = (e) => { e.preventDefault(); dz.classList.add('over'); };
  dz.ondragleave = () => dz.classList.remove('over');
  dz.ondrop = (e) => { e.preventDefault(); dz.classList.remove('over'); handleFiles(e.dataTransfer.files); };
}

function handleFile(e) { handleFiles(e.target.files); }

function handleFiles(files) {
  if (!files || !files[0]) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    pendingImgData = e.target.result;
    document.getElementById('dropZone').innerHTML = `<img src="${pendingImgData}" style="max-height:100px;max-width:100%;border:1px solid var(--border);">`;
  };
  reader.readAsDataURL(files[0]);
}

function switchImgTab(tab) {
  document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', (i===0&&tab==='url')||(i===1&&tab==='upload')));
  document.getElementById('imgtab-url').classList.toggle('active', tab === 'url');
  document.getElementById('imgtab-upload').classList.toggle('active', tab === 'upload');
}

function insertImage() {
  const src = pendingImgData || document.getElementById('imgUrl').value.trim();
  if (!src) { toast('–£–ö–ê–ñ–ò–¢–ï –ò–°–¢–û–ß–ù–ò–ö –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø'); return; }
  const entity = getEntity(activeId);
  if (!entity) return;
  if (!entity.blocks) entity.blocks = [];
  entity.blocks.push({ type: 'image', src, align: document.getElementById('imgAlign').value, size: 'medium', caption: '' });
  closeModal('imageOverlay');
  renderBlocks(entity);
  toast('–ú–ê–¢–ï–†–ò–ê–õ –ü–†–ò–ö–†–ï–ü–õ–Å–ù');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveAll() {
  saveCurrentEntity();
  localStorage.setItem('scp_entities', JSON.stringify(entities));
  toast('–î–ê–ù–ù–´–ï –°–û–•–†–ê–ù–ï–ù–´ –í –ë–ê–ó–£');
}

setInterval(() => { if (activeId && isAdmin) saveAll(); }, 30000);

document.addEventListener('keydown', (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === 's') { e.preventDefault(); if (isAdmin) saveAll(); }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openOverlay(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

document.querySelectorAll('.overlay').forEach(o => {
  o.addEventListener('click', (e) => { if (e.target === o) o.classList.remove('open'); });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function esc(s) {
  return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = '// ' + msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}
</script>
</body>
</html>
